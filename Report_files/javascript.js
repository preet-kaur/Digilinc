
GRANIFY_CONFIG = {
  SHOP_ID: 1318,
  cookies_domain: "packtpub.com",
  use_iframe: false,
  analytics_tracker: [['UA-67033221-1',true,true,true,false]],
  local_jquery: false
};
(function(){var e,t,n,r,i,s,o,u;window.GLOBAL=window,window.parent!==window&&document.getElementById("js-iframe-async")&&(window.GLOBAL=window.parent);if(((o=GLOBAL.Granify)!=null?o.enabled:void 0)!=null)window.Granify={},Granify.enabled=!1;else{GLOBAL.Granify?window.Granify=GLOBAL.Granify:(window.Granify={},GLOBAL.Granify=window.Granify),Granify.enabled=!0,Granify.stopped=!1,Granify.trackers=[],Granify.tracker_classes=[],t=!0,i=!0,((u=GRANIFY_CONFIG.cookies_domain)!=null?u.trim().length:void 0)>0&&GRANIFY_CONFIG.cookies_domain!=="localhost"?Granify.cookies_domain="."+GRANIFY_CONFIG.cookies_domain.trim():Granify.cookies_domain="",Granify.use_iframe=GRANIFY_CONFIG.use_iframe,n=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"";try{document.cookie="_gr_cc=1;expires="+(new Date("2020/01/01 00:00:00")).toGMTString()+";"+n+"path=/",s=new RegExp("(?:^|\\W)_gr_cc=([^;]*)"),document.cookie.match(s)||(t=!1)}catch(a){r=a,t=!1}document.cookie="_gr_cc=;expires="+(new Date("1977/01/01 00:00:00")).toGMTString()+";"+n+"path=/",document.cookie="_gr_cc=;expires="+(new Date("1977/01/01 00:00:00")).toGMTString()+";path=/";try{window.localStorage.setItem("_gr_l","1"),window.localStorage.getItem("_gr_l")||(i=!1),window.localStorage.removeItem("_gr_l")}catch(a){r=a,i=!1}Granify.localStorageWorking=i,Granify.enabled||(Granify.enabled=i||t),!t&&!Granify.use_iframe&&(Granify.enabled=!1),e=navigator.cookieEnabled,typeof navigator.cookieEnabled=="undefined"&&!e&&(document.cookie="testcookie",e=document.cookie.indexOf("testcookie")!==-1),e||(Granify.enabled=!1),s=new RegExp("(?:^|\\W)enable_granify=([^;]*)");try{document.cookie.match(s)[1]==="0"&&(Granify.enabled=!1)}catch(a){r=a}}}).call(this),typeof JSON!="object"&&(JSON={}),function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return typeof t=="string"?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o=gap,u,a=t[e];a&&typeof a=="object"&&typeof a.toJSON=="function"&&(a=a.toJSON(e)),typeof rep=="function"&&(a=rep.call(t,e,a));switch(typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";gap+=indent,u=[];if(Object.prototype.toString.apply(a)==="[object Array]"){s=a.length;for(n=0;n<s;n+=1)u[n]=str(n,a)||"null";return i=u.length===0?"[]":gap?"[\n"+gap+u.join(",\n"+gap)+"\n"+o+"]":"["+u.join(",")+"]",gap=o,i}if(rep&&typeof rep=="object"){s=rep.length;for(n=0;n<s;n+=1)typeof rep[n]=="string"&&(r=rep[n],i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i))}else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&u.push(quote(r)+(gap?": ":":")+i));return i=u.length===0?"{}":gap?"{\n"+gap+u.join(",\n"+gap)+"\n"+o+"}":"{"+u.join(",")+"}",gap=o,i}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(e,t,n){var r;gap="",indent="";if(typeof n=="number")for(r=0;r<n;r+=1)indent+=" ";else typeof n=="string"&&(indent=n);rep=t;if(!t||typeof t=="function"||typeof t=="object"&&typeof t.length=="number")return str("",{"":e});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&typeof i=="object")for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),r!==undefined?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),function(e,t){"use strict";var n="0.7.3",r="",i="?",s="function",o="undefined",u="object",a="major",f="model",l="name",c="type",h="vendor",p="version",d="architecture",v="console",m="mobile",g="tablet",y="smarttv",b="wearable",w="embedded",E={extend:function(e,t){for(var n in t)"browser cpu device engine os".indexOf(n)!==-1&&t[n].length%2===0&&(e[n]=t[n].concat(e[n]));return e},has:function(e,t){if(typeof e=="string")return t.toLowerCase().indexOf(e.toLowerCase())!==-1},lowerize:function(e){return e.toLowerCase()}},S={rgx:function(){var e,n=0,r,i,a,f,l,c,h=arguments;while(n<h.length&&!l){var p=h[n],d=h[n+1];if(typeof e===o){e={};for(a in d)f=d[a],typeof f===u?e[f[0]]=t:e[f]=t}r=i=0;while(r<p.length&&!l){l=p[r++].exec(this.getUA());if(!!l)for(a=0;a<d.length;a++)c=l[++i],f=d[a],typeof f===u&&f.length>0?f.length==2?typeof f[1]==s?e[f[0]]=f[1].call(this,c):e[f[0]]=f[1]:f.length==3?typeof f[1]===s&&(!f[1].exec||!f[1].test)?e[f[0]]=c?f[1].call(this,c,f[2]):t:e[f[0]]=c?c.replace(f[1],f[2]):t:f.length==4&&(e[f[0]]=c?f[3].call(this,c.replace(f[1],f[2])):t):e[f]=c?c:t}n+=2}return e},str:function(e,n){for(var r in n)if(typeof n[r]===u&&n[r].length>0){for(var s=0;s<n[r].length;s++)if(E.has(n[r][s],e))return r===i?t:r}else if(E.has(n[r],e))return r===i?t:r;return e}},x={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:"NT 6.4",RT:"ARM"}}}},T={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[l,p,a],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[l,"Opera"],p,a],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[l,p,a],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[l,"IE"],p,a],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[l,"Yandex"],p,a],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[l,/_/g," "],p,a],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i,/(uc\s?browser|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i],[l,p,a],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[l,"Dolphin"],p,a],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[l,"Chrome"],p,a],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[p,a,[l,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[p,a,l],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[l,[a,S.str,x.browser.oldsafari.major],[p,S.str,x.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[l,p,a],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[l,"Netscape"],p,a],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[l,p,a]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[d,"amd64"]],[/(ia32(?=;))/i],[[d,E.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[d,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[d,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[d,/ower/,"",E.lowerize]],[/(sun4\w)[;\)]/i],[[d,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+;))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[d,E.lowerize]]],device:[[/\((ipad|playbook);[\w\s\);-]+(rim|apple)/i],[f,h,[c,g]],[/applecoremedia\/[\w\.]+ \((ipad)/],[f,[h,"Apple"],[c,g]],[/(apple\s{0,1}tv)/i],[[f,"Apple TV"],[h,"Apple"]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[h,f,[c,g]],[/(kf[A-z]+)\sbuild\/[\w\.]+.*silk\//i],[f,[h,"Amazon"],[c,g]],[/(sd|kf)[0349hijorstuw]+\sbuild\/[\w\.]+.*silk\//i],[[f,S.str,x.device.amazon.model],[h,"Amazon"],[c,m]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[f,h,[c,m]],[/\((ip[honed|\s\w*]+);/i],[f,[h,"Apple"],[c,m]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|huawei|meizu|motorola|polytron)[\s_-]?([\w-]+)*/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[h,f,[c,m]],[/\(bb10;\s(\w+)/i],[f,[h,"BlackBerry"],[c,m]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7)/i],[f,[h,"Asus"],[c,g]],[/(sony)\s(tablet\s[ps])/i],[h,f,[c,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[h,f,[c,v]],[/android.+;\s(shield)\sbuild/i],[f,[h,"Nvidia"],[c,v]],[/(playstation\s[3portablevi]+)/i],[f,[h,"Sony"],[c,v]],[/(sprint\s(\w+))/i],[[h,S.str,x.device.sprint.vendor],[f,S.str,x.device.sprint.model],[c,m]],[/(lenovo)\s?(S(?:5000|6000)+(?:[-][\w+]))/i],[h,f,[c,g]],[/(htc)[;_\s-]+([\w\s]+(?=\))|\w+)*/i,/(zte)-(\w+)*/i,/(alcatel|geeksphone|huawei|lenovo|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]+)*/i],[h,[f,/_/g," "],[c,m]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[f,[h,"Microsoft"],[c,v]],[/(kin\.[onetw]{3})/i],[[f,/\./g," "],[h,"Microsoft"],[c,m]],[/\s((milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?(:?\s4g)?))[\w\s]+build\//i,/(mot)[\s-]?(\w+)*/i],[[h,"Motorola"],f,[c,m]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[f,[h,"Motorola"],[c,g]],[/android.+((sch-i[89]0\d|shw-m380s|gt-p\d{4}|gt-n8000|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[h,"Samsung"],f,[c,g]],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-n900))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)*/i,/sec-((sgh\w+))/i],[[h,"Samsung"],f,[c,m]],[/(samsung);smarttv/i],[h,f,[c,y]],[/\(dtv[\);].+(aquos)/i],[f,[h,"Sharp"],[c,y]],[/sie-(\w+)*/i],[f,[h,"Siemens"],[c,m]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]+)*/i],[[h,"Nokia"],f,[c,m]],[/android\s3\.[\s\w-;]{10}(a\d{3})/i],[f,[h,"Acer"],[c,g]],[/android\s3\.[\s\w-;]{10}(lg?)-([06cv9]{3,4})/i],[[h,"LG"],f,[c,g]],[/(lg) netcast\.tv/i],[h,f,[c,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w+)*/i],[f,[h,"LG"],[c,m]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[f,[h,"Lenovo"],[c,g]],[/linux;.+((jolla));/i],[h,f,[c,m]],[/((pebble))app\/[\d\.]+\s/i],[h,f,[c,b]],[/android.+;\s(glass)\s\d/i],[f,[h,"Google"],[c,b]],[/(mobile|tablet);.+rv\:.+gecko\//i],[[c,E.lowerize],h,f]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[l,p],[/rv\:([\w\.]+).*(gecko)/i],[p,l]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[l,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[l,[p,S.str,x.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[l,"Windows"],[p,S.str,x.os.windows.version]],[/\((bb)(10);/i],[[l,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)[\/\s]([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego|contiki)[\/\s-]?([\w\.]+)*/i,/linux;.+(sailfish);/i],[l,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[l,"Symbian"],p],[/\((series40);/i],[l],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[l,"Firefox OS"],p],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[l,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[l,"Chromium OS"],p],[/(sunos)\s?([\w\.]+\d)*/i],[[l,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[l,p],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[l,"iOS"],[p,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i,/(macintosh|mac(?=_powerpc)\s)/i],[[l,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]+)*/i,/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms)/i,/(unix)\s?([\w\.]+)*/i],[l,p]]},N=function(t,n){if(!(this instanceof N))return(new N(t,n)).getResult();var i=t||(e&&e.navigator&&e.navigator.userAgent?e.navigator.userAgent:r),s=n?E.extend(T,n):T;this.getBrowser=function(){return S.rgx.apply(this,s.browser)},this.getCPU=function(){return S.rgx.apply(this,s.cpu)},this.getDevice=function(){return S.rgx.apply(this,s.device)},this.getEngine=function(){return S.rgx.apply(this,s.engine)},this.getOS=function(){return S.rgx.apply(this,s.os)},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this.setUA(i)};N.VERSION=n,N.BROWSER={NAME:l,MAJOR:a,VERSION:p},N.CPU={ARCHITECTURE:d},N.DEVICE={MODEL:f,VENDOR:h,TYPE:c,CONSOLE:v,MOBILE:m,SMARTTV:y,TABLET:g,WEARABLE:b,EMBEDDED:w},N.ENGINE={NAME:l,VERSION:p},N.OS={NAME:l,VERSION:p};if(typeof exports!==o)typeof module!==o&&module.exports&&(exports=module.exports=N),exports.UAParser=N;else{e.UAParser=N,typeof define===s&&define.amd&&define(function(){return N});var $=e.jQuery||e.Zepto;if(typeof $!==o){var C=new N;$.ua=C.getResult(),$.ua.get=function(){return C.getUA()},$.ua.set=function(e){C.setUA(e);var t=C.getResult();for(var n in t)$.ua[n]=t[n]}}}}(this),function(){Granify.enabled&&(Granify.SHOP_ID=GRANIFY_CONFIG.SHOP_ID,Granify.has_category_script=GRANIFY_CONFIG.category_script,Granify.has_custom_script=GRANIFY_CONFIG.custom_script,Granify.use_local_jquery=GRANIFY_CONFIG.local_jquery,Granify.rb=function(){return this},Granify.rb.get_asset_host=function(){var e;return localStorage.getItem("granify_local_url")?localStorage.getItem("granify_local_url"):(e=localStorage.getItem("granify_asset_url"),"http://"+e.match(/[^\\/]{3,}/).toString())},Granify.rb.server_ga_stores=[],Granify.rb.matching_host="//matching.granify.com",Granify.rb.asset_host="//cdn.granify.com",Granify.rb.app_host="//app.granify.com",Granify.rb.env="production",Granify.domain=Granify.rb.asset_host,Granify.rb.version={rb:"2015-12-10 23:18:47 +0000",js:158},Granify.rb.environment=function(e){return"production"===e},Granify.rb.get_analytics=function(){return Granify.analyticsID=GRANIFY_CONFIG.analytics_tracker})}.call(this),function(){var e,t,n,r,i;window.is_ie8=!1,Granify.is_ie=!1,r=window.navigator.userAgent,e=r.indexOf("MSIE "),n=r.indexOf("Trident/");if(e>0||n>0)Granify.is_ie=!0,e>0?i=parseInt(r.substring(e+5,r.indexOf(".",e)),10):n>0&&(t=r.indexOf("rv:"),i=parseInt(r.substring(t+3,r.indexOf(".",t)),10)),i===8&&(window.is_ie8=!0),i<9&&(Granify.enabled=!1)}.call(this),function(){window.addGranifyListener=function(e,t,n){return e.addEventListener?e.addEventListener(t,n,!0):e.attachEvent("on"+t,n)},window.removeGranifyListener=function(e,t,n){return e.removeEventListener?e.removeEventListener(t,n,!0):e.detachEvent("on"+t,n)}}.call(this),function(){Granify.enabled&&(Date.prototype.addHours=function(e){return this.setTime(this.getTime()+e*60*60*1e3),this},Date.prototype.addSeconds=function(e){return this.setTime(this.getTime()+e*1e3),this},Granify.getFormattedDate=function(){var e;return e=new Date,e.getUTCFullYear()+"-"+("00"+(e.getUTCMonth()+1)).slice(-2)+"-"+("00"+e.getUTCDate()).slice(-2)+" "+("00"+e.getUTCHours()).slice(-2)+":"+("00"+e.getUTCMinutes()).slice(-2)+":"+("00"+e.getUTCSeconds()).slice(-2)},Granify.getExpiresDateByYear=function(e){var t;return t=new Date,t.setFullYear(e),t},Granify.getTimezone=function(){return-((new Date).getTimezoneOffset()/60)})}.call(this),function(){Granify.enabled&&(Granify.showDebug=function(e){var t,n,r,i,s,o,u;t=GLOBAL.document.getElementById("granify_debug"),t||(Granify.addStyleRules("#granify_debug{position:absolute;z-index:999999;top:0;left:0;width:800px;padding:10px;height:auto;border:1px solid red;background:rgba(0,0,0,.9);.log{border-bottom:1px solid #ccc;margin-bottom:10px;white-space:normal;&.info{color:lighten(#0F0,40%)}&.warn{color:lighten(#FF7F00,20%)}&.debug{color:#fff}&.error{color:lighten(#F00,40%)}.separator{height:5px;background-color:#fff;margin-bottom:10px}"),t=GLOBAL.document.createElement("div"),t.id="granify_debug",GLOBAL.document.body.appendChild(t)),i=GLOBAL.document.createElement("div"),i.className="separator",t.appendChild(i);if(e.logs){u=e.logs;for(s=0,o=u.length;s<o;s++)r=u[s],n=GLOBAL.document.createElement("div"),n.className="log "+r[0],n.innerHTML=r[0]+": "+r[1],t.appendChild(n)}if(e.error)return n=GLOBAL.document.createElement("div"),n.className="log error",n.innerHTML=e.error+"<br/>"+e.backtrace.join("<br/>"),t.appendChild(n)},Granify.testDebug=function(e){if(GLOBAL.$!=null)return GLOBAL.$("#test-errors").prepend(e+"<br>")})}.call(this),function(){Granify.enabled&&(Granify.iframeCallbacks={},Granify.setIframeData=function(e,t,n,r){return n==null&&(n=0),r==null&&(r="set"),Object.prototype.toString.call(n)==="[object Date]"&&(n=+n),Granify.execAfterFrameLoaded(function(){return Granify.frame.contentWindow.postMessage(""+r+":"+e+"="+t+"@"+n,"*")})},Granify.getToggle=function(e,t){return Granify.getIframeData(e,t,"get-toggle")},Granify.setToggle=function(e,t){return Granify.setIframeData(e,t,0,"set-toggle")},Granify.setSharedData=function(e,t,n){var r;n==null&&(n=0),Granify.use_iframe&&Granify.setIframeData(Granify.keyname(e),t,n);try{return n===0&&(n=null),Granify.setCookie(Granify.keyname(e,!0),t,n)}catch(i){return r=i,Granify.log_error("Can't set cookie "+e+" with value "+t)}},Granify.getIframeData=function(e,t,n){var r;return n==null&&(n="get"),(r=Granify.iframeCallbacks)[e]==null&&(r[e]=[]),Granify.iframeCallbacks[e].push(t),Granify.execAfterFrameLoaded(function(){return Granify.frame.contentWindow.postMessage(""+n+":"+e,"*")})},Granify.getSharedData=function(e,t){return Granify.use_iframe?Granify.getIframeData(Granify.keyname(e),t):t(Granify.getCookie(Granify.keyname(e)))},Granify.messageDispatcher=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(!e.origin.match(/granify/)&&!e.origin.match(/localhost|localdocker/))return;r=e.data,Object.prototype.toString.call(r)==="[object String]"&&(u=r.match(/([@\w]+):(.*)/));if(u){s=u[1],a=u[2],o=s.replace("@"+Granify.SHOP_ID,""),a==="undefined"&&(a=Granify.getCookie(Granify.keyname(o,!0))),o==="uuid"&&(n=Granify.getCookie(Granify.keyname(o,!0)),Granify.isString(n)&&n.length>0&&n!==a&&(a=n));if(Granify.iframeCallbacks[s]){c=Granify.iframeCallbacks[s];for(f=0,l=c.length;f<l;f++){t=c[f];try{t&&t(a)}catch(h){i=h,Granify.error(i,"messageDispatch")}}return delete Granify.iframeCallbacks[s]}}},addGranifyListener(window,"message",Granify.messageDispatcher))}.call(this),function(){Granify.enabled&&(Granify.isObject=function(e){return Object.prototype.toString.call(e)==="[object Object]"},Granify.isBoolean=function(e){return e===!0||e===!1||Object.prototype.toString.call(e)==="[object Boolean]"},Granify.isNumber=function(e){return Object.prototype.toString.call(e)==="[object Number]"},Granify.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"},Granify.isString=function(e){return Object.prototype.toString.call(e)==="[object String]"},Granify.isFunction=function(e){return Object.prototype.toString.call(e)==="[object Function]"})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.compact_object=function(e){var t,n,r,i,s,o,u,a;Granify.isArray(e)?r=[]:r={};if(typeof e=="object"){e=Granify.packObj(e);for(s in e){o=e[s];if(typeof o=="number"&&o!==0||typeof o=="string"&&o.length!==0)r[s]=o;else if(Granify.isArray(o)){t=[];for(u=0,a=o.length;u<a;u++)i=o[u],n=Granify.compact_object(i),n!=null&&t.push(n);t.length>0&&(r[s]=t)}else typeof o=="object"&&o!=null&&(n=Granify.compact_object(o),n!=null&&JSON.stringify(n)!=="{}"&&(r[s]=n))}}return r},Granify.reduce_precision=function(e){var t,n,r;t={};for(n in e)r=e[n],t[n]={d:Granify.round(r.d),t:Granify.round(r.t),s:Granify.round(r.s),a:Granify.round(r.a),c:Granify.round(r.c)},r.e!=null&&(t[n].e=r.e);return t},Granify.reduce_ms_precision=function(e){var t,n,r,i,s;Granify.isArray(e)?t=[]:t={};for(n in e){i=e[n];if(typeof i=="object"&&!Granify.isArray(i)){t[n]={};for(r in i)s=i[r],isNaN(s)&&(s=0),t[n][r]=parseFloat(Granify.round(s))}else t[n]=i}return t},Granify.data_aliases={id:"i",session:"s",class_name:"cn",uuid:"id",site_id:"sid",cart_token:"tok",order_sum:"os",cart_size:"cs",cart_items:"ci",cart_present:"cp",start_time:"st",visit_duration:"vd",status:"sts",page_type:"pt",mouse_distance:"md",scroll_distance:"sd",scroll_depth:"sh",tab_changes:"tc",mouse_heatmap:"mh",mouse_stats:"ms",timezone:"tz",source:"src",referer:"ref",service:"srv",query:"qry",current_time:"ct",medium:"me",content:"co",campaign:"ca",term:"te",over:"ov",text:"tx",links:"lk",images:"im",other:"oh",time:"tm",buttons:"bu",selections:"sel",click:"cl",copied_text:"cx",orig_length:"ol",path:"p",scroll_top:"sc",viewport:"v",tags:"t",category:"cat",subcategory:"scat",data:"dt",flags:"f",name:"n",price:"pr",widget_latency_full:"wlf",widget_latency_js:"wlj",entry_page:"ep",entry_referrer:"er",entry_page_type:"ept",has_unconfirmed_orders:"uo",mouse_active_time:"ma",time_since_start:"tss",time_since_dom:"tsd"},Granify.packObj=function(t){var n,r,i,s;Granify.isArray(t)?r=[]:r={};for(n in t){i=t[n],s=["flags","cart_size","order_sum","cart_present","timezone"];if((i==null||i===""||i===0||i.length===0||i==="{}")&&e.call(s,n)<0)continue;Granify.data_aliases[n]!=null?Granify.isNumber(i)?r[Granify.data_aliases[n]]=Granify.round(i):Granify.isObject(i)?r[Granify.data_aliases[n]]=Granify.packObj(i):r[Granify.data_aliases[n]]=i:r[n]=i}return r},Granify.removeUnchangedData=function(t){var n,r,i;if(Granify.latestSentData){r=["uuid","session","site_id","start_time","visit_duration","tags","flags","x","current_time","has_unconfirmed_orders"],i={};for(n in t)e.call(r,n)<0&&Granify.latestSentData[n]===t[n]||(i[n]=t[n]);return i}return t}}.call(this),function(){typeof String.prototype.trim!="function"&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),Granify.strDiff=function(e,t){return e.length>t.length?e.replace(t,""):t.replace(e,"")},Granify.isLocationChanged=function(e){var t;return t=Granify.strDiff(e,GLOBAL.location.href),t!==""&&t!=="#"&&t!=="#."}}.call(this),function(){Granify.roundProperty=function(e,t){if(e)return e[t]=Granify.round(e[t])},Granify.round=function(e){var t;return t=e||0,Granify.isNumber(e)&&(t=parseFloat(Granify.roundOnePlace(e))),t},Granify.isRounded=function(e){return Granify.isNumber(e)?10*e-parseInt(10*e)===0:!1},Granify.roundAllProperties=function(e){var t,n,r;e==null&&(e=Granify),r=[];for(t in e)n=e[t],Granify.isNumber(n)?Granify.isRounded(n)?r.push(void 0):r.push(Granify.roundProperty(n)):Granify.isObject(n)?r.push(Granify.roundAllProperties(n)):r.push(void 0);return r},Granify.roundOnePlace=function(e){return Math.round(e*10)/10}}.call(this),function(){Granify.enabled&&(Granify.throttle=function(e,t,n){var r,i,s,o,u,a;return i=r=u=a=null,o=0,n||(n={}),s=function(){var t;return o=(t=n.leading===false)!=null?t:{0:new Date},a=null,u=e.apply(i,r)},function(){var f,l;return f=new Date,!o&&n.leading===!1&&(o=f),l=t-(f-o),i=this,r=arguments,l<=0?(clearTimeout(a),a=null,o=f,u=e.apply(i,r)):!a&&n.trailing!==!1&&(a=setTimeout(s,l)),u}})}.call(this),function(){Granify.enabled&&(Granify.getDocumentHeight=function(){var e;return e=GLOBAL.document,Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.body.clientHeight,e.documentElement.clientHeight)},Granify.getDocumentWidth=function(){var e,t;return(typeof GLOBAL!=="undefined"&&GLOBAL!==null?(t=GLOBAL.document)!=null?t.body:void 0:void 0)==null?0:(e=GLOBAL.document,Math.max(e.body.scrollWidth,e.documentElement.scrollWidth,e.body.offsetWidth,e.documentElement.offsetWidth,e.body.clientWidth,e.documentElement.clientWidth))},Granify.ValidIpAddressRegex=/(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])/,Granify.forceSecureProtocol=function(e){return e||Granify.log_error("Granify.forceSecureProtocol was passed an invalid value, url is undefined"),e.match(/localhost|localdocker/)||e.match(Granify.ValidIpAddressRegex)?e:e.indexOf("//")===0?"https:"+e:e.replace("http://","https://")},Granify.insertFrame=function(){var e;return e=document.getElementsByTagName("body")[0],e?(Granify.frame=document.createElement("iframe"),Granify.frame.src=Granify.forceSecureProtocol(Granify.domain)+("/identifier.html?matching="+Granify.rb.matching_host),Granify.frame.style.display="none",Granify.frame.title="Granify identifier",addGranifyListener(Granify.frame,"load",function(){return Granify.frameLoaded=!0}),e.appendChild(Granify.frame)):setTimeout(Granify.insertFrame,100)},Granify.insertStylesheet=function(e,t,n){var r;return t==null&&(t=""),n==null&&(n=function(){}),r=GLOBAL.document.createElement("link"),r.rel="stylesheet",r.type="text/css",r.className=t,r.href=e,r.onload=n,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.addStyleRules=function(e,t){var n;return t==null&&(t="granify-style-sheet"),n=document.createElement("style"),n.className=t,n.type="text/css",is_ie8?n.styleSheet.cssText=e:n.innerHTML=e,GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(n)},Granify.insertScript=function(e,t,n){var r;return t==null&&(t=function(){}),n==null&&(n=null),r=GLOBAL.document.createElement("script"),r.src=e,n&&(r.id=n),r.readyState?r.onreadystatechange=function(){if(r.readyState==="loaded"||r.readyState==="complete")return r.onreadystatechange=function(){},t()}:r.onload=function(){return t()},GLOBAL.document.getElementsByTagName("HEAD")[0].appendChild(r)},Granify.execAfterDOMAvailable=function(e){return GLOBAL.document.readyState==="complete"||!is_ie8&&document.readyState==="interactive"?setTimeout(function(){return e.call(this)},0):setTimeout(function(){return Granify.execAfterDOMAvailable(e)},100)},Granify.execAfterDOMLoaded=function(e){return GLOBAL.document.readyState==="complete"?setTimeout(function(){return e.call(this)},0):setTimeout(function(){return Granify.execAfterDOMLoaded(e)},100)},Granify.execAfterFrameLoaded=function(e){return Granify.frameLoaded||!Granify.use_iframe?e.call(this):setTimeout(function(){return Granify.execAfterFrameLoaded(e)},100)},Granify.createXPathFromElement=function(e){var t,n,r;n=[];while(e&&e.nodeType===1){if(typeof e.hasAttribute=="function"?e.hasAttribute("id"):void 0)n.unshift("id("+e.getAttribute("id")+")");else if(typeof e.hasAttribute=="function"?e.hasAttribute("class"):void 0)n.unshift(e.nodeName.toLowerCase()+"[@class="+e.getAttribute("class")+"]");else{r=e.previousSibling,t=1;while(r)r.nodeName===e.nodeName&&t++,r=r.previousSibling;n.unshift(e.nodeName.toLowerCase()+"["+t+"]")}e=e.parentNode}return n.length?"/"+n.join("/"):null})}.call(this),function(){var e={}.hasOwnProperty;Granify.enabled&&(Granify.hashToQuery=function(t){var n,r,i;r=[];for(n in t){if(!e.call(t,n))continue;i=t[n],i!==void 0&&r.push(""+n+"="+encodeURIComponent(i))}return r.join("&")},Granify.JSONP=function(e,t,n,r){var i,s;return t==null&&(t={}),r==null&&(r=!0),i=document.head||document.getElementsByTagName("head")[0],s=document.createElement("script"),r&&(s.async="async"),s.charset="UTF-8",t.callback="granify_cb_"+ +(new Date),window[t.callback]=n,s.src=e+"?"+Granify.hashToQuery(t),s.onload=function(){return i.removeChild(s)},i.insertBefore(s,i.firstChild)},Granify.AJAX=function(e,t,n){var r;return t==null&&(t={}),n==null&&(n=function(){}),r=new XMLHttpRequest,e=e+"?"+Granify.hashToQuery(t),r.onreadystatechange=function(){var e;if(r.readyState===4&&r.status===200)return e=(new Function("return "+r.responseText))(),n(e)},r.open("GET",e,!0),r.send()},Granify.POST=function(e,t,n,r){var i,s,o;t==null&&(t={}),n==null&&(n=function(){}),r==null&&(r=function(){});try{return s=JSON.stringify(t),e+="?json=true",window.XDomainRequest!=null?(o=new XDomainRequest,o.onerror=function(){return r()},o.onload=function(){var e;return e=(new Function("return "+o.responseText))(),n(e)},o.open("POST",e)):(o=new XMLHttpRequest,o.onreadystatechange=function(){var e;if(o.readyState===4)return o.status===200?(e=(new Function("return "+o.responseText))(),n(e)):r()},o.open("POST",e,!0),o.setRequestHeader("Content-type","text/plain")),o.send(s)}catch(u){return i=u,Granify.error(i,"POST"),r()}})}.call(this),function(){var e={}.hasOwnProperty;Granify.enabled&&(Granify.not_synced_errors=[],Granify.last_error_sync=null,Granify.error=function(e,t){var n,r,i;n={name:""+t+"-"+e.name+"-"+Granify.ua.browser.name+"-"+Granify.version.js,message:e.message,version:Granify.version.rb,stack:(r=e.stack)!=null?r.toString():void 0,column:e.columnNumber,site_id:Granify.SHOP_ID,UUID:Granify.UUID,session:Granify.SESSION,context_data:e.context_data,env:Granify.rb.env},(i=window.console)!=null&&typeof i.log=="function"&&i.log("Granify.error: ",n.name,n.message),Granify.not_synced_errors.push(n),Granify.errors.push(""+n.name+" - "+n.message),Granify.test_mode&&GLOBAL.$!=null&&GLOBAL.$("#test-errors").empty().append("ERROR: "+JSON.stringify(n));if(Granify.throw_errors)throw e;return Granify.syncErrors()},Granify.syncErrors=function(){var e;if(Granify.not_synced_errors.length===0)return;if(new Date-Granify.last_error_sync<1e3)return;return Granify.last_error_sync=new Date,Granify.not_synced_errors.length>5&&(e=Granify.not_synced_errors.length,Granify.not_synced_errors=Granify.not_synced_errors.slice(0,5),Granify.log_error("More then 5 errors per second",{errors_count:e})),Granify.POST(""+Granify.matching+"/error",{errors:JSON.stringify(Granify.not_synced_errors)}),Granify.not_synced_errors=[],setTimeout(function(){return Granify.syncErrors()},1e3)},Granify.log_error=function(e,t){var n;t==null&&(t={});if(!Granify.send_validation_errors)return;Granify.test_mode&&GLOBAL.$!=null&&GLOBAL.$("#test-errors").empty().append("ERROR: "+JSON.stringify(t));try{throw typeof console!="undefined"&&console!==null&&console.log("Granify.com error: "+e,t),new Error}catch(r){return n=r,n.name=e,t&&(n.message=typeof JSON!="undefined"&&JSON!==null?JSON.stringify(t):void 0),Granify.error(n,"log_error")}},Granify.testsDebug=function(e){if(Granify.testsDebugMessages!=null)return Granify.testsDebugMessages.push(e)},Granify.addErrorHandling=function(t){var n,r,i;i=[];for(r in t){if(!e.call(t,r))continue;n=t[r],typeof n=="function"&&r!=="rb"&&r!=="error"&&r!=="addErrorHandling"&&r!=="uuid"?i.push(t[r]=function(e,n){return function(){var r;try{return n.apply(t,arguments)}catch(i){return r=i,Granify.error(r,""+e)}}}(r,n)):i.push(void 0)}return i})}.call(this),function(){Granify.enabled&&(Granify.getCookie=function(e,t){var n,r,i,s,o,u;t==null&&(t=!1);try{s=new RegExp("(?:^|\\W)"+e+"=([^;]*)","g"),u=[],r=s.exec(GLOBAL.document.cookie);while(r)i=decodeURI(r[1]),i!==o&&u.push(i),o||(o=i),r=s.exec(GLOBAL.document.cookie);u.length>1&&Granify.log_error("Multiple cookie occurrences",{key:e,value:o,values:u})}catch(a){n=a,Granify.log_error("Error reading cookie",{key:e,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:n.message})}return Granify.use_iframe&&Granify.localStorageWorking&&!o&&!t&&(o=Granify.getStorage(e)),o},Granify.setCookie=function(e,t,n){var r,i,s,o;try{n==null&&(n=new Date("2020/01/01 00:00:00")),r=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"";if(e==="_gr_ep"||e==="_gr_ept"||e==="_gr_er")r="";s=encodeURI(t).replace(/;/g,"%3B"),o=Granify.isNumber(n)?new Date(n):n,GLOBAL.document.cookie=""+e+"="+s+";expires="+o.toGMTString()+";"+r+"path=/"}catch(u){i=u,Granify.log_error("Error writing cookie",{key:e,writeValue
:s,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:i.message})}if(Granify.use_iframe&&Granify.localStorageWorking)return Granify.setStorage(e,t,n)},Granify.eraseCookie=function(e){var t,n,r;try{n=Granify.cookies_domain?"domain="+Granify.cookies_domain+";":"",t=Granify.getCookie(e,!0),GLOBAL.document.cookie=""+e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"+n+"path=/",GLOBAL.document.cookie=""+e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;path=/"}catch(i){r=i,Granify.log_error("Error deleting cookie",{key:e,cookieValue:t,clientDate:new Date,cookiesDomain:Granify.cookies_domain,location:location.toString(),exceptionMsg:r.message})}if(Granify.use_iframe&&Granify.localStorageWorking)return Granify.eraseStorage(e)})}.call(this),function(){Granify.enabled&&(Granify.getStorage=function(e){var t,n,r,i;if(!Granify.localStorageWorking)return;i=null;try{i=window.localStorage.getItem(e),r=JSON.parse(i),r&&(r.expires!=null?(n=r.expires,parseInt(n)>+(new Date)?i=r.data:(i=null,Granify.eraseStorage(e))):i=r)}catch(s){t=s,t instanceof SyntaxError?Granify.log_error("Error parsing local storage value into JSON",{key:e,value:i,clientDate:new Date,domain:Granify.cookies_domain,location:location.toString(),exceptionMsg:t.message}):Granify.log_error("Error reading value from local storage",{key:e,clientDate:new Date,domain:Granify.cookies_domain,location:location.toString(),exceptionMsg:t.message})}return i},Granify.setStorage=function(e,t,n){var r,i;if(!Granify.localStorageWorking)return;n==null&&(n=new Date("2020/01/01 00:00:00"));try{return r=JSON.stringify({expires:+n,data:t}),window.localStorage.setItem(e,r)}catch(s){return i=s,Granify.log_error("Error writing value to local storage",{key:e,writeValue:r,clientDate:new Date,domain:Granify.cookies_domain,location:location.toString(),exceptionMsg:i.message})}},Granify.eraseStorage=function(e){var t;if(!Granify.localStorageWorking)return;try{return window.localStorage.removeItem(e)}catch(n){return t=n,Granify.log_error("Error deleting value from local storage",{key:e,clientDate:new Date,domain:Granify.cookies_domain,location:location.toString(),exceptionMsg:t.message})}})}.call(this),function(){Granify.enabled&&(Granify.events={},Granify.trigger=function(e){var t;return(t=Granify.events)[e]==null&&(t[e]={}),Granify.events[e].triggered=!0,Granify.triggerEventCallbacks(e)},Granify.triggerEventCallbacks=function(e){var t,n,r,i;if(!(typeof Granify!="undefined"&&Granify!==null?(r=Granify.events[e])!=null?r.callbacks:void 0:void 0))return;i=[];while(Granify.events[e].callbacks.length>0)try{t=Granify.events[e].callbacks.pop(),i.push(t.apply())}catch(s){n=s,t!=null?i.push(Granify.error(n,"Event callback error: "+e+",  "+t.toString())):i.push(void 0)}return i},Granify.on=function(e,t){var n,r;(n=Granify.events)[e]==null&&(n[e]={}),(r=Granify.events[e])["callbacks"]==null&&(r.callbacks=[]),Granify.events[e].callbacks.push(t);if(Granify.events[e].triggered)return Granify.triggerEventCallbacks(e)})}.call(this),function(){Granify.enabled&&(Granify.isMutexLocked=function(){return Granify.getCookie("_g_mux")!=null},Granify.lockMutex=function(){var e;return e=new Date(+(new Date)+5e3),Granify.setCookie("_g_mux",1,e)},Granify.releaseMutex=function(){return Granify.eraseCookie("_g_mux")},Granify.waitForMutex=function(e){return Granify.isMutexLocked()?setTimeout(function(){return Granify.waitForMutex(e)},100):e()})}.call(this),function(){Granify.enabled&&(Granify.getParam=function(e,t,n){var r,i,s,o,u,a,f,l;t==null&&(t=null),n==null&&(n=window.location.search),Granify.isArray(n)?(s=[],n.forEach(function(e){return s.push((e.split("?")[1]||e.replace("?","")).split("&"))})):s=(n.split("?")[1]||n.replace("?","")).split("&"),o=null;for(a=0,f=s.length;a<f;a++)r=s[a],Granify.isString(r)?(l=r.split("="),i=l[0],u=l[1]):i=r[0],e===i&&(o=u||!0);return o||t},Granify.paramExists=function(e,t){return t==null&&(t=window.location.search),!!Granify.getParam(e,!1,t)})}.call(this),function(){(function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;l=this,b=void 0,r=function(e,t,n){var r,i;r=t&&n||0,i=0,t=t||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){i<16&&(t[r+i++]=c[e])});while(i<16)t[r+i++]=0;return t},i=function(e,t){var n,r;return r=t||0,n=a,n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+"-"+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]+n[e[r++]]},o=function(e,t,n){var r,s,o,u,a,f,l,c,h,p,v,m,g;u=t&&n||0,r=t||[],e=e||{},s=e.clockseq!==null?e.clockseq:v,a=e.msecs!==null?e.msecs:(new Date).getTime(),c=e.nsecs!==null?e.nsecs:g+1,o=a-m+(c-g)/1e4,o<0&&e.clockseq===null&&(s=s+1&16383),(o<0||a>m)&&e.nsecs===null&&(c=0);if(c>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");m=a,g=c,v=s,a+=122192928e5,h=((a&268435455)*1e4+c)%4294967296,r[u++]=h>>>24&255,r[u++]=h>>>16&255,r[u++]=h>>>8&255,r[u++]=h&255,p=a/4294967296*1e4&268435455,r[u++]=p>>>8&255,r[u++]=p&255,r[u++]=p>>>24&15|16,r[u++]=p>>>16&255,r[u++]=s>>>8|128,r[u++]=s&255,l=e.node||d,f=0;while(f<6)r[u+f]=l[f],f++;return t?t:i(r)},u=function(t,n,r){var s,o,u;s=n&&r||0,typeof t=="string"&&(n=t==="binary"?new e(16):null,t=null),t=t||{},u=t.random||(t.rng||b)(),u[6]=u[6]&15|64,u[8]=u[8]&63|128;if(n){o=0;while(o<16)n[s+o]=u[o],o++}return n||i(u)};if(typeof l.require=="function")try{m=l.require("crypto").randomBytes,b=m&&function(){return m(16)}}catch(E){t=E}!b&&l.crypto&&crypto.getRandomValues&&(y=new Uint8Array(16),b=function(){return crypto.getRandomValues(y),y}),b||(g=new Array(16),b=function(){var e,t;e=0,t=void 0;while(e<16)(e&3)===0&&(t=Math.random()*4294967296),g[e]=t>>>(e&3)<<3&255,e++;return g}),e=typeof l.Buffer=="function"?l.Buffer:Array,a=[],c={},n=0;while(n<256)a[n]=(n+256).toString(16).substr(1),c[a[n]]=n,n++;w=b(),d=[w[0]|1,w[1],w[2],w[3],w[4],w[5]],f=(w[6]<<8|w[7])&16383,h=0,p=0,s=u,s.v1=o,s.v4=u,s.parse=r,s.unparse=i,s.BufferClass=e,typeof define=="function"&&define.amd?define(function(){return s}):typeof module!="undefined"&&module.exports?module.exports=s:(v=l.uuid,s.noConflict=function(){return l.uuid=v,s},l.uuid=s)}).call(Granify)}.call(this),function(){Granify.enabled&&(Granify.includeMixin=function(e,t){var n,r,i;i=t.prototype;for(r in i)n=i[r],e[r]=n;return e})}.call(this),function(){var e;Granify.enabled&&(e=function(){function e(){this.start()}return e.prototype.start=function(){},e.prototype.stop=function(){},e.prototype.reset=function(){},e.prototype.getData=function(){return{}},e}(),Granify.Tracker=e)}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e},i=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(e=function(e){function p(){return t=p.__super__.constructor.apply(this,arguments),t}var n,s,o,u,a,f,l,c,h=this;return r(p,e),p.prototype.start=function(){var e,t,n,r,i,s,o;try{e=this,this.reset(),Granify.lastBlockTrack=new Date,is_ie8?r=GLOBAL.document:r=GLOBAL,addGranifyListener(GLOBAL.document,"mousemove",c),o=["mouseover","mouseout","mouseup","click"];for(i=0,s=o.length;i<s;i++)n=o[i],addGranifyListener(r,n,a);return addGranifyListener(GLOBAL,"scroll",l),addGranifyListener(GLOBAL,"copy",f)}catch(u){return t=u,Granify.error(t,"mouseTracker-start")}},l=Granify.throttle(function(){var e,t,n,r;if(Granify.stopped||GLOBAL.document.body==null)return;return t=((n=GLOBAL.document)!=null?(r=n.documentElement)!=null?r.scrollTop:void 0:void 0)||GLOBAL.document.body.scrollTop,Granify.scroll_distance+=Math.abs(Granify.prev_scroll_top-t),Granify.prev_scroll_top=t,e=(t+GLOBAL.innerHeight)/Granify.getDocumentHeight()*100,e=Granify.round(e),Granify.scroll_depth=e>Granify.scroll_depth?e:Granify.scroll_depth,Granify.idle_time=0,Granify.lastScroll=new Date},100),c=function(e){var t;if(Granify.stopped)return;t=e||GLOBAL.event;if(is_ie8&&typeof e.clientX=="unknown")return;try{return n(),o(e.pageX||e.clientX,e.pageY||e.clientY)}catch(r){return e=r,Granify.error(e,"getMouseStats")}},o=Granify.throttle(function(e,t){var n,r,i,s,o,u,a,f,l,c,h,p;a=e-Granify.prev_mouse_pos.x,f=t-Granify.prev_mouse_pos.y,Granify.mouse_distance+=Math.sqrt(a*a+f*f),Granify.prev_mouse_pos.y?n=Math.abs(t-Granify.prev_mouse_pos.y):n=0,l=Granify.getDocumentWidth()/2,s=Math.floor(Math.abs(l-e)/50),o=Math.floor(t/50),e<l?i="L":i="R",r=i+s.toString()+"x"+o.toString(),Granify.mouse_heatmap[r]==null&&(Granify.mouse_heatmap[r]={},Granify.mouse_heatmap[r].t=0,Granify.mouse_heatmap[r].d=0,Granify.mouse_heatmap[r].c=0),u=Math.sqrt(a*a+f*f),c=u*10,n=(c-Granify.prev_mouse_pos.s)/10,isNaN(c)&&(c=0),isNaN(n)&&(n=0),Granify.mouse_heatmap[r].d+=u,Granify.mouse_heatmap[r].s=c,Granify.mouse_heatmap[r].a=n,Granify.prev_mouse_pos={x:e,y:t,s:Granify.mouse_heatmap[r].s,a:Granify.mouse_heatmap[r].a,block:r},Granify.idle_time=0;if(GLOBAL.document.body){Granify.scrollTop=GLOBAL.document.body.scrollTop||GLOBAL.document.documentElement.scrollTop,h=l-350,p=50;if(e<h&&t-Granify.scrollTop<p)return Granify.mouse_heatmap[r].e=1}},100),a=function(e){var t,n,r,i,o;if(Granify.stopped)return;t=e||GLOBAL.event,n=e.type,r=e.target||e.srcElement,i=e.pageX||e.clientX,o=e.pageY||e.clientY;try{return s(n,r,i,o)}catch(u){return e=u,Granify.error(e,"mouse_context")}},s=Granify.throttle(function(e,t,n,r){var s,o,a,f,l,c,h,p;n==null&&(n=0),r==null&&(r=0),l=["B","P","STRONG","DIV","SPAN","I","EM","LI"],f=t.tagName;switch(e){case"click":c="click",s=1;break;case"mouseover":Granify.event_start_time=(new Date).getTime(),c="over",s=1;break;case"mouseout":c="time",Granify.event_start_time?s=((new Date).getTime()-Granify.event_start_time)/1e3:s=0;break;default:c="selection"}c==="selection"&&GLOBAL.getSelection!=null&&u()!==""&&(Granify.mouse_stats.selections+=1);if(c==="click"){a={},a.path=Granify.createXPathFromElement(t),a.id=t.id,a.class_name=t.className,a.time=Granify.round((new Date).getTime()/1e3),a.x=parseInt(n),a.y=parseInt(r);if(f==="A"||f==="BUTTON"||f==="INPUT"&&(t.type.toUpperCase()==="SUBMIT"||t.type.toUpperCase()==="BUTTON"))a.text=t.innerText;Granify.mouse_stats.clicks.push(a),o=Granify.prev_mouse_pos.block,o&&o!==""&&Granify.mouse_heatmap&&Granify.mouse_heatmap[o]&&((h=Granify.mouse_heatmap[o]).c==null&&(h.c=0),Granify.mouse_heatmap[o].c+=1)}if(typeof Granify!="undefined"&&Granify!==null?!Granify.mouse_stats:!void 0)Granify.mouse_stats={};return Granify.mouse_stats[c]||(Granify.mouse_stats[c]={links:0,text:0,images:0,buttons:0,other:0}),f==="A"?Granify.mouse_stats[c].links+=s:i.call(l,f)>=0&&((p=t.children)!=null?p.length:void 0)===0&&t.innerText!==""?Granify.mouse_stats[c].text+=s:f==="IMG"?Granify.mouse_stats[c].images+=s:f==="BUTTON"||f==="INPUT"&&(t.type.toUpperCase()==="SUBMIT"||t.type.toUpperCase()==="BUTTON")?Granify.mouse_stats[c].buttons+=s:Granify.mouse_stats[c].other+=s},100),n=function(){var e,t,n,r,i;return i=Granify.getDocumentWidth()/2,n=Math.floor(Math.abs(i-Granify.prev_mouse_pos.x)/50),r=Math.floor(Granify.prev_mouse_pos.y/50),Granify.prev_mouse_pos.x<i?t="L":t="R",e=t+n.toString()+"x"+r.toString(),Granify.mouse_heatmap[e]==null&&(Granify.mouse_heatmap[e]={},Granify.mouse_heatmap[e].t=0,Granify.mouse_heatmap[e].d=0),Granify.tracking_stopped||(Granify.mouse_heatmap[e].t+=(new Date-Granify.lastBlockTrack)/1e3),Granify.lastBlockTrack=new Date},u=function(){var e,t,n,r,i,s;try{n="";if(GLOBAL.getSelection!=null){s=GLOBAL.getSelection();if(s.rangeCount){e=GLOBAL.document.createElement("div"),r=0,i=s.rangeCount;while(r<i)e.appendChild(s.getRangeAt(r).cloneContents()),++r;n=e.innerHTML}}else GLOBAL.document.selection!=null&&GLOBAL.document.selection.type==="Text"&&(n=GLOBAL.document.selection.createRange().htmlText);return n}catch(o){return t=o,""}},f=function(e){var t;if(Granify.stopped)return;try{if(GLOBAL.document.getSelection)return t={text:GLOBAL.document.getSelection().toString().replace(/[\"\\\']/gi,"").substring(0,140),orig_length:GLOBAL.document.getSelection().toString().length},Granify.mouse_stats.copied_text.push(t)}catch(n){return e=n,Granify.error(e,"getMouseCopy")}},p.prototype.stop=function(){var e,t,n,r,i,s;try{is_ie8?n=GLOBAL.document:n=GLOBAL,removeGranifyListener(GLOBAL.document,"mousemove",this.handleStats),s=["mouseover","mouseout","mouseup","click"];for(r=0,i=s.length;r<i;r++)t=s[r],removeGranifyListener(n,t,this.handleMouseContext);return removeGranifyListener(GLOBAL,"scroll",this.handleScroll),removeGranifyListener(GLOBAL,"copy",this.handleMouseCopy)}catch(o){return e=o,Granify.error(e,"mouseTracker-stop")}},p.prototype.reset=function(){var e,t,n,r,i,s,o,u,a,f,l,c;Granify.scroll_distance=0,Granify.scroll_depth=0,Granify.prev_scroll_top=0,Granify.mouse_distance=0,Granify.prev_mouse_pos={x:0,y:0,s:(o=typeof Granify!=="undefined"&&Granify!==null?(u=Granify.prev_mouse_pos)!=null?u.s:void 0:void 0)!=null?o:0,a:(a=typeof Granify!=="undefined"&&Granify!==null?(f=Granify.prev_mouse_pos)!=null?f.a:void 0:void 0)!=null?a:0},Granify.mouse_heatmap={},Granify.mouse_stats={},Granify.mouse_stats.selections=0,l=["over","click","time"];for(n=0,i=l.length;n<i;n++){t=l[n],Granify.mouse_stats[t]={},c=["text","links","images","buttons","other"];for(r=0,s=c.length;r<s;r++)e=c[r],Granify.mouse_stats[t][e]=0}return Granify.mouse_stats.copied_text=[],Granify.mouse_stats.clicks=[]},p.prototype.getData=function(){var e,t,n,r,i,s,o;try{return t={mouse_distance:Granify.mouse_distance!=null?Granify.round(Granify.mouse_distance):0,scroll_distance:(n=Granify.scroll_distance)!=null?n:0,scroll_depth:(r=Granify.scroll_depth)!=null?r:0,mouse_heatmap:(i=JSON.stringify(Granify.compact_object(Granify.reduce_precision(Granify.mouse_heatmap))))!=null?i:"{}",mouse_stats:(s=JSON.stringify(Granify.compact_object(Granify.reduce_ms_precision(Granify.mouse_stats))))!=null?s:"{}",scroll_top:(o=Granify.prev_scroll_top)!=null?o:0},Granify.mouse_heatmap={},Granify.mouse_stats.clicks=[],t}catch(u){return e=u,Granify.error(e,"mouseTracker-getData"),{}}},p}.call(this,Granify.Tracker),Granify.tracker_classes.push(e))}.call(this),function(){var e,t,n={}.hasOwnProperty,r=function(e,t){function i(){this.constructor=e}for(var r in t)n.call(t,r)&&(e[r]=t[r]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Granify.enabled&&(e=function(e){function i(){return t=i.__super__.constructor.apply(this,arguments),t}var n;return r(i,e),i.prototype.start=function(){var e;try{return addGranifyListener(GLOBAL,"keyup",n)}catch(t){return e=t,Granify.error(e,"keyboardTracker-start")}},n=Granify.throttle(function(){return Granify.idle_time=0},100),i.prototype.stop=function(){var e;try{return removeGranifyListener(GLOBAL,"keyup",n)}catch(t){return e=t,Granify.error(e,"keyboardTracker-stop")}},i}(Granify.Tracker))}.call(this),function(){var e,t,n=function(e,t){return function(){return e.apply(t,arguments)}},r={}.hasOwnProperty,i=function(e,t){function i(){this.constructor=e}for(var n in t)r.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};Granify.enabled&&(Granify.ua=(new UAParser).getResult(),e=function(e){function r(){return this.handler=n(this.handler,this),t=r.__super__.constructor.apply(this,arguments),t}return i(r,e),r.prototype.start=function(){var e;try{return this.reset(),GLOBAL.document.hidden!=null?(this.hidden="hidden",this.visibilityChange="visibilitychange"):GLOBAL.document.mozHidden!=null?(this.hidden="mozHidden",this.visibilityChange="mozvisibilitychange"):GLOBAL.document.msHidden!=null?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):GLOBAL.document.webkitHidden!=null&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),addGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return e=t,Granify.error(e,"browserTracker-start")}},r.prototype.handler=function(){var e;try{if(Granify.stopped)return;return GLOBAL.document[this.hidden]?(Granify.tab_changes+=1,Granify.page_visit+=((new Date).getTime()-Granify.start_time)/1e3):Granify.start_time=(new Date).getTime()}catch(t){return e=t,Granify.error(e,"handleVisibilityChange")}},r.prototype.stop=function(){var e;try{return removeGranifyListener(GLOBAL.document,this.visibilityChange,this.handler)}catch(t){return e=t,Granify.error(e,"browserTracker-stop")}},r.prototype.getReferrer=function(){var e,t,n;if(((n=GLOBAL.document)!=null?n.referrer:void 0)==null){Granify.log_error("Unable to determine referrer, GLOBAL.document.referrer is falsey");return}try{e=decodeURI(GLOBAL.document.referrer)}catch(r){t=r,e=decodeURI(unescape(GLOBAL.document.referrer).replace(/%/g,"")).replace(/(http|https):\/\//,"")}return e.replace(/(http|https):\/\//,"")},r.prototype.getData=function(){var e,t,n;try{return Granify.referrer==null&&(Granify.referrer=this.getReferrer()),GLOBAL.location.origin||(GLOBAL.location.origin=GLOBAL.location.protocol+"//"+GLOBAL.location.hostname+(GLOBAL.location.port?":"+GLOBAL.location.port:"")),t=GLOBAL.location.toString().replace(GLOBAL.location.origin,""),{tab_changes:(n=Granify.tab_changes)!=null?n:0,viewport:JSON.stringify({h:Math.max(GLOBAL.document.documentElement.clientHeight,GLOBAL.innerHeight||0),w:Math.max(GLOBAL.document.documentElement.clientWidth,GLOBAL.innerWidth||0)}),timezone:Granify.getTimezone(),referer:Granify.referrer,path:t}}catch(r){return e=r,Granify.error(e,"browserTracker-getData")}},r.prototype.reset=function(){return Granify.tab_changes=0},r}(Granify.Tracker),Granify.tracker_classes.push(e))}.call(this),function(){Granify.enabled&&(Granify.setData=function(e,t){return Granify.data||(Granify.data={}),Granify.data[e]=t},Granify.time_since=function(e){return((new Date).getTime()-e)/1e3})}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.getGaAttributes=function(){var e,t,n,r,i,s,o,u,a;try{s=Granify.getCookie("__utmz");if(s!=null&&s.length>0){t={},a=s.split(".").slice(4).join(".").split("|");for(o=0,u=a.length;o<u;o++)r=a[o],i=r.split("="),t[i[0]]=i[1],t[i[0]]!=null&&(t[i[0]]=t[i[0]].replace(/\(/,""),t[i[0]]=t[i[0]].replace(/\)/,""));return n={},t.utmcmd!=null&&(n.medium=t.utmcmd),t.utmcsr!=null&&(n.source=t.utmcsr),t.utmcct!=null&&(n.content=t.utmcct.replace(/\t|\r|\n/gm,"")),t.utmccn!=null&&(n.campaign=t.utmccn),t.utmctr!=null&&(n.term=t.utmctr.replace(/\t|\r|\n/gm,"")),n}return{}}catch(f){return e=f,Granify.error(e,"getGaAttributes")}},Granify.shouldTrackGa=function(){return Granify.analyticsID.length>0},Granify.loadGaTracking=function(){var e,t,n,r,i,s,o,u;if(typeof granifyGA!="undefined"&&granifyGA!==null||!Granify.shouldTrackGa())return;e=GLOBAL.GoogleAnalyticsObject,e&&GLOBAL[e]&&Granify.isFunction(GLOBAL[e])?window.granifyGA=GLOBAL[e]:function(e,t,n,r,i,s,o){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,s=t.createElement(n),o=t.getElementsByTagName(n)[0],s.async=1,s.src=r,o.parentNode.insertBefore(s,o)}(window,document,"script","//www.google-analytics.com/analytics.js","granifyGA"),o=Granify.analyticsID,u=[];for(t=i=0,s=o.length;i<s;t=++i)n=o[t],r={cookieDomain:GLOBAL.location.host,cookieName:"_granifyGA_"+t,name:"granifyTracker"+t},Granify.shouldTrackGaOnServerSide()&&(r.userId=Granify.UUID,r.clientId=Granify.UUID),u.push(granifyGA("create",n[0],r));return u},Granify.trackGaEvent=function(e,t,n){var r,i,s,o,u,a,f,l,c;if(!Granify.shouldTrackGa())return;(typeof granifyGA=="undefined"||granifyGA===null)&&Granify.loadGaTracking(),l=Granify.analyticsID,c=[];for(r=a=0,f=l.length;a<f;r=++a){u=l[r],s=u[1],i=u[2];if(e==="customer"&&!i)continue;if(e==="message"&&t==="control-group"&&!s)continue;o={},u[4]&&(o.nonInteraction=1),c.push(granifyGA("granifyTracker"+r+".send","event",e,t,n,o))}return c},Granify.sendGaGroup=function(e){var t;if(!Granify.getCookie("_gr_ga"+Granify.SHOP_ID))return Granify.trackGaEvent("customer","group",e),t=+(new Date).addHours(.166),Granify.setCookie("_gr_ga"+Granify.SHOP_ID,"1",t)},Granify.sendGaOrder=function(e){var t,n,r,i,s,o,u,a,f,l,c;if(!Granify.shouldTrackGa())return;(typeof granifyGA=="undefined"||granifyGA===null)&&Granify.loadGaTracking(),r=(e.total_price||0)-(e.subtotal_price||0)-(e.total_tax||0),r<0&&(r=0),f=Granify.analyticsID,c=[];for(t=s=0,u=f.length;s<u;t=++s){i=f[t];if(!i[3])continue;granifyGA("granifyTracker"+t+".require","ecommerce","ecommerce.js"),granifyGA("granifyTracker"+t+".ecommerce:addTransaction",{id:String(e.order_number),affiliation:String(Granify.SHOP_ID),revenue:String(e.subtotal_price||0),shipping:String(r),tax:String(e.total_tax||0),currency:e.currency||"USD"});if(e.line_items){l=e.line_items;for(o=0,a=l.length;o<a;o++)n=l[o],granifyGA("granifyTracker"+t+".ecommerce:addItem",{id:String(e.order_number),name:String(n.name),sku:String(n.product_id),category:"General",price:String(n.price||0),quantity:String(n.quantity||0),currency:e.currency||"USD"})}c.push(granifyGA("granifyTracker"+t+".ecommerce:send"))}return c},Granify.on("offer:shown",function(){var e,t;if(Granify.previewMode||Granify.previewModeWithMatching)return;e=Granify.old_offer;if(!Granify.getCookie("_gr_ga_c"+e.id))return Granify.trackGaEvent("message","shown",""+e.id+":"+e.outcome.headline),t=+(new Date).addHours(.166),Granify.setCookie("_gr_ga_c"+e.id,"1",t)}),Granify.on("control_group",function(){var e;if(!Granify.getCookie("_gr_ga_cg"))return Granify.trackGaEvent("message","control-group","not-shown"),e=+(new Date).addHours(.166),Granify.setCookie("_gr_ga_cg","1",e)}),Granify.shouldTrackGaOnServerSide=function(){var t;return Granify.shouldTrackGa()?(t=Number(Granify.SHOP_ID),e.call(Granify.rb.server_ga_stores,t)>=0):!1})}.call(this);var I18n=I18n||{};I18n.defaultLocale="en",I18n.fallbacks=!1,I18n.defaultSeparator=".",I18n.locale=null,I18n.PLACEHOLDER=/(?:\{\{|%\{)(.*?)(?:\}\}?)/gm,I18n.isValidNode=function(e,t,n){return e[t]!==null&&e[t]!==n},I18n.lookup=function(e,t){var t=t||{},n=e,r=this.prepareOptions(I18n.translations),i=r[t.locale||I18n.currentLocale()],t=this.prepareOptions(t),s;if(!i)return;typeof e=="object"&&(e=e.join(this.defaultSeparator)),t.scope&&(e=t.scope.toString()+this.defaultSeparator+e),e=e.split(this.defaultSeparator);while(e.length>0){s=e.shift(),i=i[s];if(!i){I18n.fallbacks&&!t.fallback&&(i=I18n.lookup(n,this.prepareOptions({locale:I18n.defaultLocale,fallback:!0},t)));break}}return!i&&this.isValidNode(t,"defaultValue")&&(i=t.defaultValue),i},I18n.prepareOptions=function(){var e={},t,n=arguments.length;for(var r=0;r<n;r++){t=arguments[r];if(!t)continue;for(var i in t)this.isValidNode(e,i)||(e[i]=t[i])}return e},I18n.interpolate=function(e,t){t=this.prepareOptions(t);var n=e.match(this.PLACEHOLDER),r,i,s;if(!n)return e;for(var o=0;r=n[o];o++)s=r.replace(this.PLACEHOLDER,"$1"),i=t[s],this.isValidNode(t,s)||(i="[missing "+r+" value]"),regex=new RegExp(r.replace(/\{/gm,"\\{").replace(/\}/gm,"\\}")),e=e.replace(regex,i);return e},I18n.translate=function(e,t){t=this.prepareOptions(t);var n=this.lookup(e,t);try{return typeof n=="object"?typeof t.count=="number"?this.pluralize(t.count,e,t):n:this.interpolate(n,t)}catch(r){return this.missingTranslation(e)}},I18n.localize=function(e,t){switch(e){case"currency":return this.toCurrency(t);case"number":return e=this.lookup("number.format"),this.toNumber(t,e);case"percentage":return this.toPercentage(t);default:return e.match(/^(date|time)/)?this.toTime(e,t):t.toString()}},I18n.parseDate=function(e){var t,n;if(typeof e=="object")return e;t=e.toString().match(/(\d{4})-(\d{2})-(\d{2})(?:[ T](\d{2}):(\d{2}):(\d{2}))?(Z|\+0000)?/);if(t){for(var r=1;r<=6;r++)t[r]=parseInt(t[r],10)||0;t[2]-=1,t[7]?n=new Date(Date.UTC(t[1],t[2],t[3],t[4],t[5],t[6])):n=new Date(t[1],t[2],t[3],t[4],t[5],t[6])}else typeof e=="number"?(n=new Date,n.setTime(e)):e.match(/\d+ \d+:\d+:\d+ [+-]\d+ \d+/)?(n=new Date,n.setTime(Date.parse(e))):(n=new Date,n.setTime(Date.parse(e)));return n},I18n.toTime=function(e,t){var n=this.parseDate(t),r=this.lookup(e);return n.toString().match(/invalid/i)?n.toString():r?this.strftime(n,r):n.toString()},I18n.strftime=function(e,t){var n=this.lookup("date");if(!n)return e.toString();n.meridian=n.meridian||["AM","PM"];var r=e.getDay(),i=e.getDate(),s=e.getFullYear(),o=e.getMonth()+1,u=e.getHours(),a=u,f=u>11?1:0,l=e.getSeconds(),c=e.getMinutes(),h=e.getTimezoneOffset(),p=Math.floor(Math.abs(h/60)),d=Math.abs(h)-p*60,v=(h>0?"-":"+")+(p.toString().length<2?"0"+p:p)+(d.toString().length<2?"0"+d:d);a>12?a-=12:a===0&&(a=12);var m=function(e){var t="0"+e.toString();return t.substr(t.length-2)},g=t;return g=g.replace("%a",n.abbr_day_names[r]),g=g.replace("%A",n.day_names[r]),g=g.replace("%b",n.abbr_month_names[o]),g=g.replace("%B",n.month_names[o]),g=g.replace("%d",m(i)),g=g.replace("%e",i),g=g.replace("%-d",i),g=g.replace("%H",m(u)),g=g.replace("%-H",u),g=g.replace("%I",m(a)),g=g.replace("%-I",a),g=g.replace("%m",m(o)),g=g.replace("%-m",o),g=g.replace("%M",m(c)),g=g.replace("%-M",c),g=g.replace("%p",n.meridian[f]),g=g.replace("%S",m(l)),g=g.replace("%-S",l),g=g.replace("%w",r),g=g.replace("%y",m(s)),g=g.replace("%-y",m(s).replace(/^0+/,"")),g=g.replace("%Y",s),g=g.replace("%z",v),g},I18n.toNumber=function(e,t){t=this.prepareOptions(t,this.lookup("number.format"),{precision:3,separator:".",delimiter:",",strip_insignificant_zeros:!1});var n=e<0,r=Math.abs(e).toFixed(t.precision).toString(),i=r.split("."),s,o=[],u;e=i[0],s=i[1];while(e.length>0)o.unshift(e.substr(Math.max(0,e.length-3),3)),e=e.substr(0,e.length-3);u=o.join(t.delimiter),t.precision>0&&(u+=t.separator+i[1]),n&&(u="-"+u);if(t.strip_insignificant_zeros){var a={separator:new RegExp(t.separator.replace(/\./,"\\.")+"$"),zeros:/0+$/};u=u.replace(a.zeros,"").replace(a.separator,"")}return u},I18n.toCurrency=function(e,t){return t=this.prepareOptions(t,this.lookup("number.currency.format"),this.lookup("number.format"),{unit:"$",precision:2,format:"%u%n",delimiter:",",separator:"."}),e=this.toNumber(e,t),e=t.format.replace("%u",t.unit).replace("%n",e),e},I18n.toHumanSize=function(e,t){var n=1024,r=e,i=0,s,o;while(r>=n&&i<4)r/=n,i+=1;return i===0?(s=this.t("number.human.storage_units.units.byte",{count:r}),o=0):(s=this.t("number.human.storage_units.units."+[null,"kb","mb","gb","tb"][i]),o=r-Math.floor(r)===0?0:1),t=this.prepareOptions(t,{precision:o,format:"%n%u",delimiter:""}),e=this.toNumber(r,t),e=t.format.replace("%u",s).replace("%n",e),e},I18n.toPercentage=function(e,t){return t=this.prepareOptions(t,this.lookup("number.percentage.format"),this.lookup("number.format"),{precision:3,separator:".",delimiter:""}),e=this.toNumber(e,t),e+"%"},I18n.pluralize=function(e,t,n){var r;try{r=this.lookup(t,n)}catch(i){}if(!r)return this.missingTranslation(t);var s;n=this.prepareOptions(n),n.count=e.toString();switch(Math.abs(e)){case 0:s=this.isValidNode(r,"zero")?r.zero:this.isValidNode(r,"none")?r.none:this.isValidNode(r,"other")?r.other:this.missingTranslation(t,"zero");break;case 1:s=this.isValidNode(r,"one")?r.one:this.missingTranslation(t,"one");break;default:s=this.isValidNode(r,"other")?r.other:this.missingTranslation(t,"other")}return this.interpolate(s,n)},I18n.missingTranslation=function(){var e='[missing "'+this.currentLocale(),t=arguments.length;for(var n=0;n<t;n++)e+="."+arguments[n];return e+='" translation]',e},I18n.currentLocale=function(){return I18n.locale||I18n.defaultLocale},I18n.t=I18n.translate,I18n.l=I18n.localize,I18n.p=I18n.pluralize;var I18n=I18n||{};I18n.translations={en:{coupon:{free:"Free",shipping:"Shipping",use_code:"Use coupon code",reduced:"OFF",open_message:"Open message",hide_message:"Hide this message",close:"CLOSE",ok:"OK",copy_paste:"Copy & paste the coupon code before closing this window.",wheel:{lucky:"Today's your lucky day!",hang_on:"Hang tight, here we go!",almost:"... almost done ...",you_won:"You won a ",discount:"discount",no_code:"No coupon code required",to_save:"to save",remember:"Remember to write down the code before closing this window!",selected:"You've been selected to play for a chance to save!",spin:"Spin the wheel",close_window:"You can <a href='#'>close this window</a> if you don't want to play."}},number:{currency:{format:{format:"%u%n",unit:"$",separator:".",delimiter:",",precision:2,significant:!1,strip_insignificant_zeros:!1}},format:{separator:".",delimiter:",",precision:3,significant:!1,strip_insignificant_zeros:!1}}},es:{coupon:{free:"Gratis",shipping:"Envio",use_code:"Usar cdigo de cupn",reduced:"OFF",open_message:"Abrir mensaje",hide_message:"Ocultar este mensaje",close:"Cerrar",ok:"OK",copy_paste:"Copiar y pegar el cdigo de cupn antes de cerrar esta ventana.",wheel:{lucky:"Hoy es tu da de suerte!",hang_on:"Preprate, aqu vamos!",almost:"... casi termina ...",you_won:"Has ganado un ",discount:"descuento",no_code:"No necesitas un cupn de descuento",to_save:"ahorrar",remember:"Recuerda tomar nota del cdigo antes de cerrar la ventana!",selected:"Fuiste seleccionado para participar en una chance para ahorrar",spin:"Gira la rueda",close_window:"Puedes <a href='#'>cerrar esta ventana</a>"}},number:{currency:{format:{delimiter:".",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:""}},format:{delimiter:".",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}},fr:{coupon:{free:"Gratuit",shipping:"Navigation",use_code:"Utilisez coupon",reduced:"rduction",open_message:"Ouvrez le message",hide_message:"Cachez ce message",close:"Fermer",ok:"OK",copy_paste:"Copiez le code promo avant de fermer ce message",wheel:{lucky:"C'est votre jour de chance!",hang_on:"Un moment. Ici nous allons!",almost:"... presque fait ...",you_won:"Vous avez gagn un",discount:"rduction",no_code:"Aucun code coupon requis",to_save:"pour sauver",remember:"Copiez le code promo avant de fermer ce message",selected:"Vous avez t slectionn pour jouer une chance de sauver!",spin:"Faites tourner la roue",close_window:"Vous <a href='#'>pouvez fermer cette fentre</a> si vous ne voulez pas jouer."}},number:{currency:{format:{delimiter:" ",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:""}},format:{delimiter:" ",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}},de:{coupon:{free:"Kostenloser",shipping:"Versand",use_code:"Gutscheincode",reduced:"Gutschein",open_message:"Nachricht ffnen",hide_message:"Nachricht ausblenden",close:"Schlieen",ok:"OK",copy_paste:"Kopieren Sie den Gutscheincode, bevor Sie das Fenster schlieen.",wheel:{lucky:"Heute ist Ihr Glckstag!",hang_on:"Und es geht los!",almost:"Jetzt wird es spannend!",you_won:"Sie haben gewonnen ",discount:"Gutschein",no_code:"Kein Gutscheincode bentigt",to_save:"Speichern",remember:"Den Gutscheincode aufschreiben, bevor Sie das Fenster schlieen!",selected:"Jetzt spielen und einen Gutschein gewinnen!",spin:"Drehen",close_window:"Wenn Sie nicht spielen mchten, <a href='#'>schlieen</a> Sie ganz einfach dieses Fenster!"}},number:{currency:{format:{delimiter:".",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:""}},format:{delimiter:".",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1}}},"en-ZA":{coupon:{free:"Free",shipping:"Shipping",use_code:"Use coupon code",reduced:"OFF",open_message:"Open message",hide_message:"Hide this message",close:"CLOSE",ok:"OK",copy_paste:"Copy & paste the coupon code before closing this window.",wheel:{lucky:"Today's your lucky day!",hang_on:"Hang tight, here we go!",almost:"... almost done ...",you_won:"You won a ",discount:"discount",no_code:"No coupon code required",to_save:"to save",remember:"Remember to write down the code before closing this window!",selected:"You've been selected to play for a chance to save!",spin:"Spin the wheel",close_window:"You can <a href='#'>close this window</a> if you don't want to play."}},number:{currency:{format:{delimiter:",",format:"%u%n",precision:2,separator:".",significant:!1,strip_insignificant_zeros:!1,unit:"R"}},format:{delimiter:",",precision:3,separator:".",significant:!1,strip_insignificant_zeros:!1}}},it:{coupon:{free:"Spedizione",shipping:"Gratuita",use_code:"Usa il codice sconto",reduced:"Meno",open_message:"Messaggio libero",hide_message:"Nascondi questo messaggio",close:"Chiuso",ok:"OK",copy_paste:"Copia e incolla questo coupon prima di chiudere la finestra.",wheel:{lucky:"Oggi  il tuo giorno fortunato!",hang_on:"Mantieniti forte, si parte!",almost:"... quasi finito ...",you_won:"Hai vinto un sconto ",discount:"",no_code:"Nessun cupon sconto richiesto",to_save:"risparmia",remember:"Ricordati di scrivere il codice prima di chiudere la finestra!",selected:"Sei stato selezionato per vincere un coupon sconto!"
,spin:"Gira la ruota",close_window:"Puoi <a href='#'>chiudere la finestra</a> se non vuoi giocare."}},number:{currency:{format:{delimiter:".",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:""}},format:{delimiter:".",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1}}},nl:{coupon:{free:"Gratis",shipping:"Verzending",use_code:"Gebruik kortingscode",reduced:"Minder",open_message:"Geopend Bericht",hide_message:"Bericht Berbergen",close:"Sluiten",ok:"OK",copy_paste:"Knip en plak de kortingscode voor dat je het venster sluit.",wheel:{lucky:"Vandaag is je geluksdag!",hang_on:"Hier gaan we dan!",almost:"... bijna klaar ...",you_won:"Je won een ",discount:"Korting",no_code:"Geen kortingscode nodig",to_save:"bewaren",remember:"Schrijf de code op voor dat je het venster sluit!",selected:"Jij bent geselecteerd voor een kans om te besparen!",spin:"Draai aan het wiel",close_window:"Je kan dit <a href='#'>venster gewoon sluiten</a> indien je niet wil spelen."}},number:{currency:{format:{delimiter:".",format:"%u%n",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:""}},format:{delimiter:".",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1}}},"pt-BR":{coupon:{free:"Grtis",shipping:"Envio",use_code:"Use o cdigo",reduced:"descuento",open_message:"Abrir mensagem",hide_message:"Ocultar mensagem",close:"Fechar",ok:"OK",copy_paste:"Copiar e colar o cdigo do cupom antes de fechar esta janela.",wheel:{lucky:"Seu dia de sorte de hoje!",hang_on:"Aguente firme, aqui vamos ns!",almost:"... quase pronto ...",you_won:"Voc ganhou um ",discount:"descuento",no_code:"No cdigo do cupomnecessrio",to_save:"para economizar",remember:"No se esquea de anotar o cdigo antes de fechar esta janela",selected:"Voc foi selecionado para jogar por uma chance de salvar!",spin:"Gire a roda",close_window:"Voc pode <a href='#'>fechar esta janela</a>, se voc no quer jogar."}},number:{currency:{format:{delimiter:".",format:"%u %n",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"R$"}},format:{delimiter:".",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}},ro:{coupon:{free:"Livrare",shipping:"Gratis",use_code:"Foloseste codul",reduced:"reducere",open_message:"Deschide oferta",hide_message:"Inchide aceasta oferta",close:"INCHIDE",ok:"OK",copy_paste:"Fa copy si paste la codul pentru discount inainte sa inchizi aceasta notificare.",wheel:{lucky:"Astazi este ziua ta norocoasa!",hang_on:"Fii pe pozitii, i-am dat drumul!",almost:"... aproape gata ...",you_won:"Ai castigat un discount de ",discount:"",no_code:"Nu iti trebuie un cod de discount",to_save:"pentru a economisi",remember:"Adu-ti aminte sa-ti notezi codul de discount inainte de a inchide aceasta notificare!",selected:"Ai fost selectat pentru o sansa de a economisi!",spin:"Invarte roata",close_window:"Poti <a href='#'>inchide aceasta notificare</a> daca nu vrei sa participi."}},number:{currency:{format:{delimiter:".",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"RON"}},format:{delimiter:".",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}},"ru-UK":{coupon:{free:"",shipping:"",use_code:"  ",reduced:"C",open_message:" ",hide_message:" ",close:"",ok:"OK",copy_paste:"C   ,    ",wheel:{lucky:"   !",hang_on:" !",almost:"...   ...",you_won:"  ",discount:"",no_code:"  ,  ",to_save:" ",remember:" ,     !",selected:",    !",spin:" ",close_window:"  <a href='#'>  </a>     ."}},number:{currency:{format:{delimiter:" ",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"."}},format:{delimiter:" ",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}},ru:{coupon:{free:"",shipping:"",use_code:"  ",reduced:"C",open_message:" ",hide_message:" ",close:"",ok:"OK",copy_paste:"C   ,    ",wheel:{lucky:"   !",hang_on:" !",almost:"...   ...",you_won:"  ",discount:"",no_code:"  , ",to_save:" ",remember:" ,     !",selected:",    !",spin:" ",close_window:"  <a href='#'>  </a>,     ."}},number:{currency:{format:{delimiter:" ",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"."}},format:{delimiter:" ",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}},sv:{coupon:{free:"Fri",shipping:"Frakt",use_code:"Anvnd rabattkod",reduced:"Rabatt",open_message:"ppna meddelande",hide_message:"Gm meddelande",close:"Stng",ok:"OK",copy_paste:"Kopiera & klistra in rabattkoden innan du stnger fnstret",wheel:{lucky:"Idag r din turdag!",hang_on:"Hll i dig, nu kr vi!",almost:"... nstan klart ...",you_won:"Du vann en ",discount:"rabatt",no_code:"Ingen rabattkod krvs",to_save:"att spara",remember:"Kom ihg att skriva ned rabattkoden innan du stnger fnstret!",selected:"Du har blivit utvald att f spela fr en chans att spara!",spin:"Snurra hjulet!",close_window:"Du kan <a href='#'>stnga fnstret</a> om du inte vill spela."}},number:{currency:{format:{delimiter:null,format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"kr"}},format:{delimiter:null,precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1}}},tr:{coupon:{free:"cretsiz",shipping:"Kargo",use_code:"Kodu kullan",reduced:"NDRM",open_message:"Mesaj a",hide_message:"Bu mesaj gizle",close:"Kapat",ok:"Tamam",copy_paste:"Bu pencereyi kapatmadan nce kupon kodunu kopyalayp yaptrn.",wheel:{lucky:"Bugn ansl gnnzdesiniz!",hang_on:"Az kald, hadi bakalm!",almost:"... neredeyse tamam ...",you_won:"unu kazandnz ",discount:"ndirim",no_code:"Kupon kodu gerekmez",to_save:"kaydetmek iin",remember:"Bu pencereyi kapatmadan nce kodu bir kenara not etmeyi unutmayn!",selected:"ndirim kazanma ans yakaladnz!",spin:"ark evir",close_window:"Oynamak istemiyorsanz bu pencereyi <a href='#'>kapatabilirsiniz</a>!"}},number:{currency:{format:{delimiter:".",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"TL"}},format:{delimiter:".",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1}}},uk:{coupon:{free:"",shipping:"",use_code:" ",reduced:"",open_message:"i ",hide_message:" ",close:"",ok:"",copy_paste:"   ,    i",wheel:{lucky:"i   !",hang_on:"!",almost:"...   ...",you_won:"  ",discount:"",no_code:"  ",to_save:" ",remember:"   ,    i!",selected:"   !",spin:" ",close_window:"  <a href='#'> </a>,    ."}},number:{currency:{format:{delimiter:" ",format:"%n %u",precision:2,separator:",",significant:!1,strip_insignificant_zeros:!1,unit:"."}},format:{delimiter:" ",precision:3,separator:",",significant:!1,strip_insignificant_zeros:!1}}}},function(){var e=[].slice;Granify.autoLink=function(){var t,n,r,i,s,o,u,a;o=arguments[0],s=2<=arguments.length?e.call(arguments,1):[],r="",i=s[0],u=/(^|\s)(\b(https?|ftp):\/\/[\-A-Z0-9+\u0026@#\/%?=~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~_|])/gi;if(s.length>0){i["callback"]!=null&&typeof i.callback=="function"&&(t=i.callback,delete i.callback);for(n in i)a=i[n],r+=" "+n+"='"+a+"'";return o.replace(u,function(e,n,i){var s,o;return o=t&&t(i),s=o||"<a href='"+i+"'"+r+">"+i+"</a>",""+n+s})}return o.replace(u,"$1<a href='$2'>$2</a>")}}.call(this),function(){GLOBAL.I18n=I18n,Granify.initCoupon=function(e){return Granify.savedCallback=e,Granify.use_local_jquery&&GLOBAL.jQuery?(Granify.JQ=GLOBAL.jQuery,Granify.JQ(function($){return Granify.savedCallback()})):Granify.insertScript(""+Granify.domain+"/assets/jquery-1.7.2.min.js",function(){return Granify.JQ=GLOBAL.jQuery.noConflict(!0),Granify.JQ(function($){return Granify.savedCallback()})})}}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(t in this&&this[t]===e)return t;return-1};Granify.enabled&&(Granify.checkOrderParameters=function(e){var t,n,r,i,s,o,u,a,f,l;e.client_order_date=parseInt(+(new Date).getTime()/1e3),Granify.localStorageWorking&&(i=Granify.getStorage("_gr_last_server_time"),i!=null&&i.time!=null&&Granify.SESSION!=null&&i.session===Granify.SESSION&&(e.order_date=i.time)),Granify.pageType="receipt",e.site_id=Granify.SHOP_ID,e.uuid=Granify.UUID||Granify.getCookie(Granify.keyname("uuid",!0)),Granify.shouldTrackGaOnServerSide()&&(e.track_ga=!0),e["financial_status"]==null&&(e.financial_status="paid"),e.financial_status=e.financial_status.toLowerCase(),(e!=null?e.subtotal_price:void 0)!=null&&e["total_line_items_price"]==null&&(e.total_line_items_price=e.subtotal_price),e.cart_token=Granify.getCartToken(!1);if(e["cart_token"]==null||e.cart_token.length===0)e.without_cart||Granify.log_error("Missing order cart_token for site "+Granify.SHOP_ID);e.cart_token=Granify.getCartToken(),e.session=Granify.SESSION||Granify.getCookie(Granify.keyname("session",!0)),e.method="post",t&&(t=JSON.parse(t),e.discount_codes||(e.discount_codes=[]),e.discount_codes=e.discount_codes.concat(t)),f=["currency","subtotal_price","order_number"];for(s=0,u=f.length;s<u;s++){n=f[s];if(!(e[n]!=null&&e[n].toString().length>0)){Granify.log_error(n+" is required !",e),e=null;break}}e["items"]!=null&&e["line_items"]==null&&(e.line_items=e.items,delete e.items);if(e["line_items"]!=null){l=e.line_items;for(o=0,a=l.length;o<a;o++){r=l[o],r.product_id==null&&(r.product_id=r.id);if(!(r.product_id!=null&&r.product_id.toString().length>0)){Granify.log_error("product_id is required !",e),e=null;break}r.variant_id!=null&&r.variant_id.toString().length>0||(r.variant_id="null")}}return e},Granify.trackOrder=function(e,t){var n,r,i,s,o=this;t==null&&(t=!1);if(!t)return Granify.getSharedData("discounts",function(t){return Granify.reloadFlags(function(){var t,n=this;try{if(Granify.getCookie("last_order")===e.order_number)return;Granify.getCookie("last_fast_order")!==e.order_number&&Granify.trackOrder(e,!0),e=Granify.checkOrderParameters(e);if(!e)return;return e.stopped=Granify.stopped,i=""+Granify.matching+"/javascript/orders/update",Granify.POST(i,e,function(){return Granify.removeUnconfirmedOrder(Granify.getCookie("last_order"))},function(){return Granify.POST(i,e,function(){return Granify.removeUnconfirmedOrder(Granify.getCookie("last_order"))})}),Granify.getCookie("last_ga_fast_order")!==e.order_number&&Granify.SESSION_INITIALIZED===1&&!e.track_ga&&Granify.sendGaOrder(e),Granify.setSharedData("discounts","[]"),Granify.setCookie("last_order",e.order_number),Granify.setHasOrders(),Granify.setCartToken(null),Granify.trackCart(!1)}catch(r){return t=r,Granify.error(t,"trackOrder")}})});e=Granify.checkOrderParameters(e);if(e){if(Granify.getCookie("last_fast_order")===e.order_number)return;return Granify.localStorageWorking&&(r=Granify.getStorage("unconfirmed_orders")||[],r.push(e),Granify.setStorage("unconfirmed_orders",r),Granify.hasUnconfirmedOrders=!0),n={},n.site_id=Granify.SHOP_ID,n.uuid=Granify.UUID||Granify.getCookie(Granify.keyname("uuid",!0)),n.session=Granify.SESSION||Granify.getCookie(Granify.keyname("session",!0)),n.order_number=e.order_number,n.subtotal_price=e.subtotal_price,n.total_price=e.total_price,n.currency=e.currency,n.item_count=((s=e["line_items"])!=null?s.length:void 0)||0,n.method="jsonp",Granify.shouldTrackGaOnServerSide()&&(n.track_ga=!0),n.stopped=Granify.stopped,i=""+Granify.matching+"/javascript/orders/fast-update",Granify.JSONP(i,n,function(e){if(e.error!=null)return Granify.JSONP(i,n,function(){})}),Granify.SESSION_INITIALIZED===1&&!n.track_ga&&Granify.getCookie("last_order")!==e.order_number&&(Granify.sendGaOrder(n),Granify.setCookie("last_ga_fast_order",n.order_number)),Granify.setCookie("last_fast_order",n.order_number)}},Granify.setHasOrders=function(){return Granify.getSharedData("has_orders",function(e){if(e!=="1")return Granify.setSharedData("has_orders","1")}),Granify.addFlag(Granify.F_IS_RETURNED_BUYER)},Granify.removeUnconfirmedOrder=function(e){var t,n,r,i,s;if(!Granify.localStorageWorking)return;r=Granify.getStorage("unconfirmed_orders")||[];for(t=i=0,s=r.length;i<s;t=++i){n=r[t];if(n.order_number===e){r.splice(t,1);break}}return r.length===0&&(Granify.hasUnconfirmedOrders=!1),Granify.setStorage("unconfirmed_orders",r)},Granify.resendUnconfirmedOrders=function(t){var n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w;if(!Granify.localStorageWorking)return;n=t!=null?JSON.parse(t):[],l=[],c=Granify.getStorage("unconfirmed_orders")||[];for(p=0,m=c.length;p<m;p++)s=c[p],(b=s.order_number,e.call(function(){var e,t,n;n=[];for(e=0,t=l.length;e<t;e++)s=l[e],n.push(s.order_number);return n}(),b)<0)&&l.push(s);a=!1,f=[],i=4,h=11;if(l!=null&&l.length>0){for(r=d=0,g=l.length;d<g;r=++d)s=l[r],s["resent_tries"]==null&&(s.resent_tries=0),(w=s.order_number,e.call(n,w)>=0)||s.resent_tries>i?(f.push(r),a=!0):(s.last_resent_date?o=(+(new Date)-s.last_resent_date)/1e3:o=(+(new Date)-s.client_order_date)/1e3,u=h+(s.resent_tries+1)*3*3,o>u&&(a=!0,s.last_resent_date=+(new Date),s.resent_tries=s.resent_tries+1,s["order_date"]==null&&(s.order_date=parseInt(s.client_order_date)-Granify.clientTimeOffset),s["uuid"]==null&&(Granify.UUID||Granify.getCookie(Granify.keyname("uuid",!0))),s["session"]==null&&(Granify.SESSION||Granify.getCookie(Granify.keyname("session",!0))),Granify.POST(""+Granify.matching+"/javascript/orders/update",s)));for(v=0,y=f.length;v<y;v++)r=f[v],l.splice(r,1);(a||l.length!==c.length)&&Granify.setStorage("unconfirmed_orders",l);if(l.length===0)return Granify.hasUnconfirmedOrders=!1}})}.call(this),function(){Granify.enabled&&(Granify.trackCart=function(e,t){var n,r,i,s,o,u,a,f,l;t==null&&(t=!0),n=window.granifyShopCart||{},delete n.ts;if(Granify.isObject(e)||Granify.isString(e)){e=JSON.parse(JSON.stringify(e)),e.page_type&&(Granify.trackPageView({page_type:e.page_type}),delete e.page_type),Granify.isString(e.items)&&(e.items=JSON.parse(e.items));if(e.items==null)return;if(!Granify.isArray(e.items)){Granify.error({name:"Cart_format_error",message:"items is not array"},"match");return}if(!Granify.getCookie("granify.cart_token")&&!e.items.length)return;r=[],o=0,u=0,l=e.items;for(a=0,f=l.length;a<f;a++){s=l[a];if(s==null)continue;s.price!=null&&s.quantity!=null&&(o+=parseFloat(s.price)*parseInt(s.quantity),u+=parseInt(s.quantity)),s.id!=null?r.push(s.id===s.variant_id||s.variant_id==null?s.id:s.id+"_"+s.variant_id):JSON&&Granify.error({name:"Cart_format_error",message:"item.id not found: "+JSON.stringify(s)},"match")}e.contents=r.join(","),e.total_price=o,e.item_count=u,e.present=e.item_count>0,n=e}else if(Granify.isArray(e)){e.length===0&&(e=[0,0]),e.length===2&&e[0]===0&&e[1]===null&&(e[1]=0);if(e.length!==2||!Granify.isNumber(e[0])||!Granify.isNumber(e[1])){Granify.error({name:"Cart_format_error",message:"Cart should be sent as an array with number of items and total price, got "+JSON.stringify(e)+"."},"match");return}e[0]>0?(n.item_count!=null&&n.total_price!=null&&(n.item_count!==e[0]||n.total_price!==e[1])&&(n={}),n.item_count=e[0],n.total_price=e[1]):n={},n.present=e[0]>0}else if(Granify.isBoolean(e)||Granify.isNumber(e))n.present!=null&&n.present!==!!e&&(n={}),n.present=!!e;n.ts==null&&(n.ts=+(new Date)),n.present==null&&(n.present=!1),Granify.cart_token||n.present&&(Granify.cart_token=Granify.getCartToken()),n.ts>(window.granifyShopCart.ts||0)&&(window.granifyShopCart=n,window.granifyShopCart.cart_token=n.cart_token||Granify.getCartToken(),window.granifyShopCart.ts=+(new Date),i=+(new Date).addHours(336),Granify.setSharedData("cart",JSON.stringify(n),i),Granify.setCartToken(n.cart_token));if(t)return Granify.sendCart(n)},Granify.sendCart=function(e){return Granify.reloadFlags(function(){var t;try{return e.site_id=Granify.SHOP_ID,e.uuid=Granify.UUID,e.session=Granify.SESSION,e.item_count=e.item_count,e.total_price=e.total_price,Granify.POST(""+Granify.matching+"/javascript/carts/update",e)}catch(n){return t=n,Granify.error(t,"sendCart"),!1}})},Granify.getCart=function(){return window.granifyShopCart!=null?window.granifyShopCart:{}},Granify.setCartToken=function(e){return e===null?(Granify.cart_token=null,Granify.eraseCookie("granify.cart_token")):(Granify.cart_token=e,Granify.setCookie("granify.cart_token",e,Granify.getExpiresDateByYear(2022))),e},Granify.getCartToken=function(e){var t;return e==null&&(e=!0),t=Granify.getCookie("granify.cart_token"),t!=null&&t.length>0||e&&(t=Granify.generateCartToken()),t},Granify.generateCartToken=function(){return Granify.setCartToken(Granify.guidGenerator())},Granify.guidGenerator=function(){var e;return e=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()})}.call(this),function(){Granify.enabled&&(Granify.trackPageView=function(e){var t;Granify.test_mode&&GLOBAL.$!=null&&Granify.testDebug("Execute Granify.trackPageView("+JSON.stringify(e)+")"),e.page_type!=null?(e.page_type=e.page_type.replace(/[^A-Za-z]/g,""),e.page_type!=="other"&&(Granify.pageType=e.page_type)):Granify.log_error("Granify.trackPageView require page_type");if(e.product==null&&e.category==null&&e.subcategory==null)return;return t={},e.category!=null&&(t.c=e.category),e.subcategory!=null&&(t.sc=e.subcategory),e.product!=null&&(t.p=Granify.compact_object(e.product)),Granify.PAGE_META=t},Granify.checkPageType=function(){Granify.pageType==null&&(Granify.pageType=Granify.getPageType()),Granify.pageType==null&&(Granify.pageType=Granify.page_type);if(Granify.pageType==="receipt")return Granify.setHasOrders()})}.call(this),function(){Granify.enabled&&(Granify.identify=function(e){return Granify.reloadFlags(function(){var t;try{return e.site_id=Granify.SHOP_ID,e.uuid=Granify.UUID,e.session=Granify.SESSION,Granify.POST(""+Granify.matching+"/javascript/users/identify",e)}catch(n){return t=n,Granify.error(t,"identify"),!1}})})}.call(this),function(){var e;Granify.enabled&&(Granify.session_expiration_delta=GLOBAL._test_session_expiration_delta||1800,Granify.flags_expiration_delta=GLOBAL._test_flags_expiration_delta||43200,Granify.session_expiration=function(){return+(new Date).addSeconds(Granify.session_expiration_delta)},Granify.flags_expiration=function(){return+(new Date).addSeconds(Granify.flags_expiration_delta)},Granify.FLAGS=null,Granify.F_NEW_SESSION=1,Granify.F_TEST_GROUP=2,Granify.F_RANDOM_SAMPLING=4,Granify.F_IS_NEW_USER=8,Granify.F_IS_RETURNED_USER=16,Granify.F_IS_RETURNED_BUYER=32,Granify.F_CG=64,Granify.F_FLAGS_INITIALIZED=128,Granify.F_CG_INITIALIZED=256,Granify.tracking_stopped=!1,Granify.tracking_initialized=!1,Granify.old_offer=null,Granify.group="unknown",Granify.matching=Granify.rb.matching_host,Granify.test_mode=!1,Granify.rb.environment("test")&&(Granify.test_mode=!0,e=Granify.getStorage("matching_host"),e!=null&&(Granify.matching="//"+e+"/goliath_mock",Granify.domain="//"+e)),Granify.getCookie("test_granify_store")&&(Granify.test_mode=!0),Granify.tracking_wait_interval=1e3,Granify.matching_requests=[],Granify.keyname=function(e,t,n){var r;return t==null&&(t=!1),n==null&&(n="@"),r=""+n+Granify.SHOP_ID,e==="g_cart"&&(e="cart"),e==="uuid"&&(r=""),Granify.use_iframe&&!t?""+e+r:e==="uuid"?"granify.uuid":"granify."+e+r},Granify.version=Granify.rb.version,Granify.getCookie("throw_granify_errors")&&(Granify.throw_errors=!0),Granify.errors=[],Granify.testsDebugMessages=[],Granify.hasUnconfirmedOrders=!1,Granify.latency={},Granify.latency.mutex=!1,window.granifyShopCart==null&&(window.granifyShopCart={}),Granify.cart_token=Granify.getCookie("granify.cart_token"),Granify.match_timeout=null,Granify.resetSources=[],Granify.rb.get_analytics(),Granify.start=function(){return addGranifyListener(GLOBAL,"beforeunload",function(){var e;try{Granify.stop()}catch(t){e=t}}),Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.start()"),Granify.isMutexLocked()||(Granify.lockMutex(),Granify.acquiredMutex=!0),setTimeout(function(){var e,t,n,r,i;Granify._stack==null&&(Granify._stack=[]),r=Granify._stack,i=[];for(t=0,n=r.length;t<n;t++)e=r[t],e[0]==="trackOrder"?i.push(Granify[e[0]](e[1],!0)):i.push(void 0);return i},0),Granify.reset("start"),Granify.getCookie("granify.pre_last_order")&&(Granify._stack.push(["trackPageView",{page_type:"receipt"}]),Granify._stack.push(["trackCart",{}]),Granify.setSharedData("cart",'{ "items": [] }'),Granify.setSharedData("discounts","[]"),Granify.setCookie("last_order",Granify.getCookie("granify.pre_last_order")),Granify.setHasOrders(),Granify.eraseCookie("granify.pre_last_order")),Granify.idle_watch=setInterval(function(){return Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.idle_watch"),Granify.idle_tracking()},1e3),setTimeout(function(){return Granify.acquiredMutex?(Granify.rb.environment("test")&&Granify.testDebug("Mutex aquired!"),Granify.onPageLoad()):(Granify.rb.environment("test")&&Granify.testDebug("Mutex not aquired!"),Granify.waitForMutex(function(){return Granify.onPageLoad()}))},0)},Granify.onPageLoad=function(){return GLOBAL.document.readyState==="complete"||Granify.is_ie&&GLOBAL.document.readyState==="interactive"?Granify.init():(Granify.is_ie&&addGranifyListener(GLOBAL,"DOMContentLoaded",Granify.init),addGranifyListener(GLOBAL,"load",Granify.init))},Granify.init=function(){var e,t,n,r,i,s;if(this.wasInitialized)return;this.wasInitialized=!0,Granify.init_time=+(new Date),s=Granify.tracker_classes;for(r=0,i=s.length;r<i;r++)e=s[r],Granify.trackers.push(new e);Granify.use_iframe&&Granify.insertFrame(),Granify.reloadFlags(function(){return Granify.acquiredMutex&&Granify.releaseMutex(),Granify.initializeMatching()}),Granify.trigger("granify:init");try{t=Granify.getStorage("granify_bookmarklet"),Granify.paramExists("granify_preview",[location.href,GLOBAL.document.referrer])&&(Granify.previewMode=!0);if(t==="open"||Granify.previewMode)return Granify.insertScript(""+Granify.domain+"/install-bookmarklet.js",function(){},"granify-bookmarklet-script")}catch(o){n=o}},Granify.initializeMatching=function(){var e,t;Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.initializeMatching()"),Granify._stack!=null&&Granify._stack.length>0&&(Granify.is_js_api=!0),Granify._stack==null&&(Granify._stack=[]);while(e=Granify._stack.shift())t=e.shift(),Granify[t].apply(null,e);return typeof Granify.platformSpecificCode=="function"&&Granify.platformSpecificCode(),Granify.match()},Granify.stop=function(){var e,t,n,r;Granify.stopped=!0,Granify.tracking_stopped=!0,r=Granify.trackers;for(t=0,n=r.length;t<n;t++)e=r[t],e.stop();return Granify.trackers=[]},Granify.resetLocal=function(){var e,t,n,r,i,s;Granify.rb.environment("test")&&Granify.testDebug("Executign Granify.resetLocal: "+arguments.callee.caller.toString()),Granify.page_visit=0,Granify.start_time=+(new Date),Granify.start_time_fixed=Granify.start_time,Granify.cumulated_active_time=0,Granify.mouse_activity_resumed_date=Granify.start_time_fixed,Granify.mouse_active_time_total=0,Granify.idle_time=0,Granify.current_time=null,i=Granify.trackers;for(n=0,r=i.length;n<r;n++)e=i[n],e.reset();return Granify.eraseCookie("_gr_ep_sent"),Granify.eraseCookie("_gr_ept_sent"),Granify.eraseCookie("_gr_er_sent"),t=Granify.getStorage("unconfirmed_orders"),t!=null&&t!==""&&t!==[]&&(Granify.hasUnconfirmedOrders=!0),(s=Granify.current_coupon)!=null&&typeof s.hide=="function"&&s.hide(),Granify.latestSentData=null},Granify.reset=function(e){return e==null&&(e="unknown"),Granify.rb.environment("test")&&Granify.testDebug("Executing Granify.reset: "+arguments.callee.caller.toString()),Granify.resetSources.length<10&&Granify.resetSources.push(e),Granify.resetLocal(),Granify.data=null,Granify.tags=[],Granify.location=GLOBAL.location.href,Granify.pageType=null},Granify.track=Granify.throttle(function(){var e,t;Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.track()"),t=(new Date).getTime(),Granify.page_visit+=(t-Granify.start_time)/1e3,Granify.start_time=t;try{Granify.reloadFlags(function(){return Granify.platformSpecificCode(),Granify.match()})}catch(n){e=n,Granify.error(e,"match")}return!0},100),Granify.scheduleNextMatch=function(){Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.scheduleNextMatch()");if(!Granify.tracking_stopped)return setTimeout(function(){return Granify.track()},Granify.tracking_wait_interval)},Granify.idle_tracking=Granify.throttle(function(){Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.idle_tracking()"),Granify.idle_time+=1;if(Granify.stopped)return;Granify.idle_time>5&&!Granify.tracking_stopped?(Granify.tracking_stopped=!0,Granify.cumulated_active_time+=Granify.time_since(Granify.mouse_activity_resumed_date)):Granify.tracking_stopped&&Granify.idle_time<=5&&(Granify.tracking_stopped=!1,Granify.mouse_activity_resumed_date=+(new Date),Granify.scheduleNextMatch());if(!Granify.tracking_stopped)return Granify.mouse_active_time_total=Granify.cumulated_active_time+Granify.time_since(Granify.mouse_activity_resumed_date)},100),Granify.handleOffer=function(e,t){var n;t==null&&(t=null);if(Granify.stopped)return;try{if((e!=null?e.tg:void 0)==null)return Granify.SESSION_INITIALIZED=2,Granify.setSharedData("session_init",+Granify.SESSION_INITIALIZED,Granify.session_expiration()),Granify.stop(),!1;Granify.SESSION_INITIALIZED=1,Granify.setSharedData("session_init",+Granify.SESSION_INITIALIZED,Granify.session_expiration()),Granify.addFlag(Granify.F_FLAGS_INITIALIZED),e.tg?(Granify.trigger("test_group"),Granify.sendGaGroup("baseline"),Granify.addFlag(Granify.F_TEST_GROUP),Granify.group="baseline"):(Granify.sendGaGroup("granify"),Granify.removeFlag(Granify.F_TEST_GROUP),Granify.trigger("granify_group"),Granify.group="granify"),e.debug&&Granify.showDebug(e),e.rs?Granify.addFlag(Granify.F_RANDOM_SAMPLING):Granify.removeFlag(Granify.F_RANDOM_SAMPLING);if(e.cg)return Granify.addFlag(Granify.F_CG_INITIALIZED),Granify.addFlag(Granify.F_CG),Granify.trigger("control_group"),!0;if(e.campaign){Granify.addFlag(Granify.F_CG_INITIALIZED),Granify.removeFlag(Granify.F_CG);if(JSON.stringify(e.campaign)===JSON.stringify(Granify.old_offer))return!0;Granify.current_coupon&&Granify.current_coupon.remove(),Granify.old_offer=e.campaign,Granify.latency.mutex=!0,Granify.loadWidget(e)}return!0}catch(r){return n=r,Granify.error(n,"handleOffer"),!1}},Granify.loadWidget=function(e){return Granify.initCoupon(function(){var t,n,r,i,s,o;try{i=e.campaign.campaign_type;switch(i){case"discount":o=e.campaign.offer.value,t=e.campaign.offer.coupon;break;case"percent":o=e.campaign.offer.value,t=e.campaign.offer.coupon;break;case"shipping":o="",t=e.campaign.offer.coupon;break;default:o="",t=""}return I18n.defaultLocale=e.campaign.outcome.locale||"en",r={id:e.campaign.id,type:i,headline:e.campaign.outcome.headline!=null?Granify.autoLink(e.campaign.outcome.headline):void 0,message:Granify.autoLink(e.campaign.outcome.text),style:e.campaign.outcome.style,amount:o,coupon:t,experiment:e.campaign.experiment,force_matching:e.force_matching},e.custom_url!=null?s=e.custom_url:s=""+Granify.domain+"/custom_assets/widget/"+r.experiment+".js",Granify.insertScript(s,function(){return Granify.current_coupon=new Granify.widget_class(r),Granify.current_coupon.initialize(),Granify.latency.offer_shown=+(new Date)})}catch(u){return n=u,Granify.error(n,"loadWidget"),!1}})},Granify.touchSession=function(){var e,t,n,r;r=Granify.session_expiration(),Granify.setSharedData("session",Granify.SESSION,r),Granify.setSharedData("session_init",Granify.SESSION_INITIALIZED,r),Granify.setSharedData("flags",Granify.FLAGS,Granify.flags_expiration()),e=Granify.getCookie("_gr_ep"),t=Granify.getCookie("_gr_ept"),n=Granify.getCookie("_gr_er"),e&&Granify.setCookie("_gr_ep",e,r),t&&Granify.setCookie("_gr_ept",t,r);if(n)return Granify.setCookie("_gr_er",n,r)},Granify.reloadFlags=function(e){if(Granify.previewMode)return;return Granify.setSharedData("check_cookies_"+Granify.start_time_fixed,"1"),Granify.getSharedData("check_cookies_"+Granify.start_time_fixed,function(t){return t==="1"?(Granify.setSharedData("check_cookies_"+Granify.start_time_fixed,"1",+(new Date).addSeconds(-100)),Granify.getSharedData("uuid",function(t){var n;return t?Granify.UUID=t:Granify.use_iframe||(Granify.UUID=Granify.uuid.v4()),Granify.setSharedData("uuid",Granify.UUID),n=!1,Granify.getSharedData("session",function(t){return t?(Granify.SESSION=parseInt(t),n=!1):(Granify.resetLocal(),Granify.SESSION=parseInt(Granify.start_time_fixed),n=!0),Granify.getSharedData("cart",function(t){return t&&(t=JSON.parse(t),Granify.trackCart(t,!1)),Granify.getSharedData("flags",function(t){return t?Granify.FLAGS=parseInt(t):Granify.FLAGS=0,n&&Granify.getSharedData("lasts",function(e){return e!=null&&e.length>0?(Granify.removeFlag(Granify.F_IS_NEW_USER),Granify.addFlag(Granify.F_IS_RETURNED_USER),Granify.getSharedData("has_orders",function(e){if(e==="1")return Granify.addFlag(Granify.F_IS_RETURNED_BUYER)})):Granify.addFlag(Granify.F_IS_NEW_USER),Granify.setSharedData("lasts",Granify.SESSION)}),Granify.getSharedData("session_init",function(t){return!t||n?Granify.SESSION_INITIALIZED=0:Granify.SESSION_INITIALIZED=parseInt(t),Granify.touchSession(),e()})})})})})):Granify.stop()})},Granify.addFlag=function(e){return Granify.FLAGS=Granify.FLAGS|e,Granify.setSharedData("flags",Granify.FLAGS,Granify.flags_expiration())},Granify.removeFlag=function(e){if((Granify.FLAGS&e)===0)return;return Granify.FLAGS=Granify.FLAGS^e,Granify.setSharedData("flags",Granify.FLAGS,Granify.flags_expiration())},Granify.match_function=function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g,y,b,w,E,S,x;if(Granify.stopped)return;Granify.rb.environment("test")&&Granify.testDebug("Execute Granify.match()");if(Granify.previewMode){Granify.stop();return}clearTimeout(Granify.match_timeout);if(!Granify.SHOP_ID||!Granify.UUID||!Granify.SESSION||Granify.FLAGS==null||Granify.SESSION_INITIALIZED==null){Granify.match_timeout=setTimeout(function(){return Granify.track()},100);return}if(!Granify.UUID.match(/^[0-9A-Fa-f-]+$/)){Granify.log_error("Wrong UUID format",{x:Granify.version.js,domain:Granify.cookies_domain,uuid:JSON.stringify(Granify.UUID)}),c=+(new Date).addHours(1),Granify.setCookie("enable_granify",0,c),Granify.setSharedData("uuid","");return}if(Granify.lastScroll&&new Date-Granify.lastScroll<500){Granify.match_timeout=setTimeout(function(){return Granify.track()},1e3);return}Granify.isLocationChanged(Granify.location)&&Granify.reset("locationChanged"),Granify.checkPageType(),u=Granify.FLAGS,Granify.touchSession(),Granify.SESSION_INITIALIZED||(u|=Granify.F_NEW_SESSION),Granify.mouse_active_time_total!=null?l=Granify.round(Granify.mouse_active_time_total):l=0,e={uuid:Granify.UUID,session:Granify.SESSION,site_id:Granify.SHOP_ID,start_time:Granify.start_time_fixed,visit_duration:Granify.page_visit!=null?Granify.round(Granify.page_visit):0,page_type:(g=Granify.pageType)!=null?g:"other",tags:Granify.tags,flags:u,mouse_active_time:l,x:Granify.version.js},granifyShopCart.present!=null&&(e.cart_present=granifyShopCart.present?1:0,e.cart_token=Granify.cart_token,e.order_sum=(y=granifyShopCart.total_price)!=null?y:0,e.cart_size=(b=granifyShopCart.item_count)!=null?b:0,e.cart_items=(w=granifyShopCart.contents)!=null?w:""),E=Granify.trackers;for(v=0,m=E.length;v<m;v++){p=E[v],a=p.getData();for(f in a)d=a[f],e[f]=d}return Granify.hasUnconfirmedOrders&&(e.has_unconfirmed_orders=+Granify.hasUnconfirmedOrders),Granify.ga==null&&(Granify.ga=JSON.stringify(Granify.packObj(Granify.getGaAttributes()))),e.ga=Granify.ga,Granify.data&&(e.data=JSON.stringify(Granify.data),Granify.data=null),Granify.latency.mutex&&Granify.latency.offer_shown&&(e.widget_latency_full=Granify.latency.offer_shown-Granify.latency.last_request_sent,e.widget_latency_js=Granify.latency.offer_shown-Granify.latency.last_request_response,Granify.latency.mutex=!1,Granify.latency.offer_shown=null),t=Granify.getCookie("_gr_ep"),n=Granify.getCookie("_gr_ep_sent"),r=Granify.getCookie("_gr_ept"),i=Granify.getCookie
("_gr_ept_sent"),s=Granify.getCookie("_gr_er"),o=Granify.getCookie("_gr_er_sent"),t&&!n&&(e.entry_page=t),r&&!i&&(e.entry_page_type=r),s&&!o&&(e.entry_referrer=s),Granify.current_time!=null?Granify.current_time=parseInt(+(new Date).getTime()/1e3):Granify.current_time=e.start_time,e!=null&&(e.current_time=Granify.current_time),Granify.timeSinceStart==null&&(typeof performance!=="undefined"&&performance!==null?(S=performance.timing)!=null?S.navigationStart:void 0:void 0)!=null&&(Granify.timeSinceStart=Granify.current_time-performance.timing.navigationStart,e.time_since_start=Granify.timeSinceStart),Granify.timeSinceDom==null&&(typeof performance!=="undefined"&&performance!==null?(x=performance.timing)!=null?x.domLoading:void 0:void 0)!=null&&(Granify.timeSinceDom=Granify.current_time-performance.timing.domLoading,e.time_since_dom=Granify.timeSinceDom),h=Granify.packObj(Granify.removeUnchangedData(e)),Granify.PAGE_META!=null&&(h.pm=JSON.stringify(Granify.PAGE_META)),Granify.latency.mutex||(Granify.latency.last_request_sent=+(new Date)),Granify.rb.environment("test")&&Granify.testDebug("Send data to Goliath: "+JSON.stringify(h)),Granify.JSONP(""+Granify.matching+"/match",h,function(t){var n;Granify.latency.mutex||(Granify.latency.last_request_response=+(new Date));if(t.error==null){t.st!=null&&t.st!==Granify.start_time_fixed&&(n=!0),Granify.rb.environment("test")&&Granify.testDebug("Received data from Goliath: "+JSON.stringify(t)),Granify.PAGE_META=null,Granify.latestSentData=e,e.entry_page&&Granify.setCookie("_gr_ep_sent","1"),e.entry_page_type&&Granify.setCookie("_gr_ept_sent","1"),e.entry_referrer&&Granify.setCookie("_gr_er_sent","1"),Granify.localStorageWorking&&t.ct&&(Granify.lastServerTime=t.ct,Granify.clientTimeOffset=parseInt(+(new Date).getTime()/1e3)-parseInt(Granify.lastServerTime),Granify.setStorage("_gr_last_server_time",{time:Granify.lastServerTime,session:Granify.SESSION})),Granify.hasUnconfirmedOrders&&Granify.resendUnconfirmedOrders(t.co);if(Granify.previewModeWithMatching||n)return Granify.scheduleNextMatch();if(Granify.handleOffer(t,u))return Granify.scheduleNextMatch()}},!1)},Granify.match=Granify.throttle(Granify.match_function,Granify.tracking_wait_interval),Granify.rb.environment("test")&&Granify.testDebug("Before Granify.start()"),Granify.addErrorHandling(Granify),Granify.start())}.call(this),function(){Granify.enabled&&(Granify.send_validation_errors=!0,Granify.platformSpecificCode=function(){var e,t;return e=Granify.getCart(),e!=null&&e.page_type!=null?Granify.pageType=e.page_type:Granify.page_type!=null&&(Granify.pageType=Granify.page_type),Granify.pageType==null&&(Granify.pageType="other"),e!=null&&e.item_count!=null&&((t=e.items)!=null?t.length:void 0)>0&&(Granify.cart_token=Granify.getCartToken()),Granify.cart_token==null&&(Granify.cart_token=""),Granify.is_js_api=!0},Granify.getPageType=function(){return Granify.pageType||"other"})}.call(this);



